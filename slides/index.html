<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSockets — Temps réel | Formation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0b0d1a;
      --bg-card: #131631;
      --bg-code: #0f1129;
      --accent-indigo: #818cf8;
      --accent-cyan: #22d3ee;
      --accent-emerald: #34d399;
      --accent-amber: #fbbf24;
      --accent-rose: #fb7185;
      --accent-purple: #a855f7;
      --text-primary: #e8edf5;
      --text-secondary: #8b92b0;
      --text-dim: #4a5078;
      --border-color: #1e2248;
      --grid-color: #161938;
      --glow-indigo: 0 0 20px rgba(129, 140, 248, 0.4);
      --glow-cyan: 0 0 20px rgba(34, 211, 238, 0.4);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.6;
    }

    /* Network dot-grid background */
    .grid-bg {
      position: fixed; inset: 0; z-index: -1; opacity: 0.25;
      background:
        radial-gradient(circle at 30px 30px, var(--grid-color) 1.5px, transparent 1.5px) 0 0 / 60px 60px,
        radial-gradient(circle at 30px 30px, rgba(129,140,248,0.08) 1px, transparent 1px) 0 0 / 60px 60px;
    }

    .grid-accents {
      position: fixed; inset: 0; z-index: -1; pointer-events: none;
    }

    .grid-accents::before {
      content: ''; position: absolute; top: 18%; left: 0; width: 100%; height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent-indigo), transparent);
      opacity: 0.08; animation: line-pulse 5s ease-in-out infinite;
    }

    .grid-accents::after {
      content: ''; position: absolute; top: 0; left: 35%; width: 2px; height: 100%;
      background: linear-gradient(180deg, transparent, var(--accent-cyan), transparent);
      opacity: 0.08; animation: line-pulse 6s ease-in-out infinite 1.5s;
    }

    @keyframes line-pulse {
      0%, 100% { opacity: 0.04; }
      50% { opacity: 0.15; }
    }

    /* Header */
    header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      background: linear-gradient(180deg, var(--bg-dark) 0%, transparent 100%);
      padding: 1rem 2rem;
    }

    .nav-container {
      display: flex; align-items: center; justify-content: space-between;
      max-width: 1400px; margin: 0 auto;
    }

    .logo {
      font-family: 'Space Grotesk', sans-serif; font-weight: 700; font-size: 1.2rem;
      color: var(--accent-indigo); text-shadow: var(--glow-indigo); letter-spacing: 1px;
    }
    .logo span { color: var(--text-dim); font-weight: 400; }

    .day-nav { display: flex; gap: 0.5rem; }

    .day-btn {
      font-family: 'Space Grotesk', sans-serif; font-size: 0.85rem; font-weight: 600;
      padding: 0.6rem 1.5rem; background: transparent;
      border: 2px solid var(--border-color); color: var(--text-secondary);
      cursor: pointer; transition: all 0.3s ease; position: relative;
      overflow: hidden; letter-spacing: 0.5px;
    }
    .day-btn:hover { border-color: var(--accent-indigo); color: var(--text-primary); }
    .day-btn.active {
      border-color: var(--accent-indigo); color: var(--bg-dark);
      background: var(--accent-indigo); text-shadow: none;
    }

    .nav-controls { display: flex; gap: 1rem; align-items: center; }

    .control-btn {
      background: transparent; border: 1px solid var(--border-color);
      color: var(--text-secondary); padding: 0.5rem; cursor: pointer;
      transition: all 0.3s ease; display: flex; align-items: center;
      justify-content: center; width: 40px; height: 40px;
    }
    .control-btn.label {
      width: auto; min-width: 44px; padding: 0.45rem 0.8rem;
      font-family: 'Space Grotesk', sans-serif; font-size: 0.7rem; letter-spacing: 1px;
    }
    .control-btn:hover { border-color: var(--accent-indigo); color: var(--accent-indigo); }
    .control-btn.active { background: var(--accent-indigo); border-color: var(--accent-indigo); color: var(--bg-dark); }
    .control-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .control-btn svg { width: 20px; height: 20px; }

    /* Main content */
    main { height: 100vh; display: flex; flex-direction: column; padding-top: 80px; }

    .slides-wrapper { flex: 1; position: relative; overflow: hidden; }

    .slide {
      position: absolute; inset: 0; display: flex; flex-direction: column;
      justify-content: center; padding: 3rem 6rem; opacity: 0;
      transform: translateX(100px); transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
    }
    .slide.active { opacity: 1; transform: translateX(0); pointer-events: auto; }
    .slide.prev { transform: translateX(-100px); }

    .slide-content { max-width: 1200px; margin: 0 auto; width: 100%; }
    .slide-number { display: none; }

    /* Typography */
    .slide-title {
      font-family: 'Space Grotesk', sans-serif; font-size: clamp(2.5rem, 6vw, 4.5rem);
      font-weight: 700; line-height: 1.1; margin-bottom: 2rem;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-indigo) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .slide-title.title-hero {
      font-size: clamp(3rem, 7vw, 5.5rem); text-align: center; margin-bottom: 2.5rem;
      background: linear-gradient(135deg, var(--accent-indigo) 0%, var(--accent-cyan) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .slide-title.title-plan {
      font-size: clamp(3.5rem, 8vw, 6rem); text-align: center; margin-bottom: 3rem;
    }

    .slide-subtitle {
      font-family: 'Inter', sans-serif; font-size: 1.8rem; font-weight: 300;
      color: var(--text-secondary); margin-bottom: 2rem;
    }

    h3 {
      font-family: 'Space Grotesk', sans-serif; font-size: 1.4rem; font-weight: 600;
      color: var(--accent-amber); margin: 2rem 0 1rem; letter-spacing: 0.5px;
    }

    /* Lists */
    ul, ol { list-style: none; margin: 1.5rem 0; }
    li {
      position: relative; padding-left: 2.5rem; margin-bottom: 1rem;
      font-size: 1.6rem; font-weight: 400;
    }
    li::before {
      content: ''; position: absolute; left: 0; top: 0.6em;
      width: 8px; height: 8px; background: var(--accent-indigo);
      box-shadow: var(--glow-indigo); border-radius: 2px;
    }
    ol { counter-reset: item; }
    ol li::before {
      content: counter(item); counter-increment: item;
      background: transparent; color: var(--accent-indigo);
      font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
      font-weight: 600; width: auto; height: auto; top: 0;
      box-shadow: none; border-radius: 0;
    }

    /* Code */
    pre {
      background: var(--bg-code); border: 1px solid var(--border-color);
      border-left: 3px solid var(--accent-cyan); padding: 1.5rem;
      margin: 1.5rem 0; overflow-x: auto; position: relative;
    }
    pre::before {
      content: 'CODE'; position: absolute; top: 0; right: 0;
      background: var(--accent-cyan); color: var(--bg-dark);
      font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;
      font-weight: 600; padding: 0.25rem 0.75rem; letter-spacing: 1px;
    }
    code { font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; line-height: 1.7; }
    p code, li code {
      background: rgba(129, 140, 248, 0.1); color: var(--accent-indigo);
      padding: 0.2rem 0.6rem; font-size: 0.95em; border-radius: 3px;
    }
    .keyword { color: var(--accent-purple); }
    .type { color: var(--accent-indigo); }
    .function { color: var(--accent-amber); }
    .string { color: var(--accent-emerald); }
    .number { color: #ff7b72; }
    .comment { color: var(--text-dim); font-style: italic; }

    /* Info boxes */
    .info-box {
      background: rgba(129, 140, 248, 0.05); border: 1px solid rgba(129, 140, 248, 0.2);
      padding: 1.5rem; margin: 1.5rem 0; position: relative; border-radius: 8px;
    }
    .info-box.warning { background: rgba(251, 191, 36, 0.05); border-color: rgba(251, 191, 36, 0.3); }
    .info-box.success { background: rgba(52, 211, 153, 0.05); border-color: rgba(52, 211, 153, 0.3); }
    .info-box.danger { background: rgba(251, 113, 133, 0.05); border-color: rgba(251, 113, 133, 0.3); }

    .info-box-title {
      font-family: 'Space Grotesk', sans-serif; font-size: 1rem; font-weight: 700;
      color: var(--accent-indigo); letter-spacing: 1px; margin-bottom: 0.75rem;
      display: flex; align-items: center; gap: 0.5rem;
    }
    .info-box p, .info-box li { font-size: 1.4rem; }
    .info-box.warning .info-box-title { color: var(--accent-amber); }
    .info-box.success .info-box-title { color: var(--accent-emerald); }
    .info-box.danger .info-box-title { color: var(--accent-rose); }

    /* Layouts */
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; align-items: start; }
    .two-col p { font-size: 1.5rem; }
    .three-col { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }
    .four-col { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; }
    .slide-content > p { font-size: 1.5rem; margin-bottom: 1rem; }

    /* Hero */
    .hero-slide { text-align: center; }
    .hero-slide .author { font-size: 1.8rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
    .hero-slide .linkedin { font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; color: var(--accent-indigo); }
    .hero-slide .linkedin a { color: inherit; text-decoration: none; }
    .hero-slide .linkedin a:hover { text-decoration: underline; }

    /* Timeline */
    .timeline-item { display: flex; gap: 1rem; margin-bottom: 1.2rem; align-items: flex-start; }
    .timeline-year {
      font-family: 'Space Grotesk', sans-serif; font-size: 1.1rem; font-weight: 700;
      color: var(--accent-cyan); min-width: 70px; text-shadow: var(--glow-cyan);
    }
    .timeline-content {
      flex: 1; padding-left: 1rem; border-left: 2px solid var(--border-color); font-size: 1.2rem;
    }

    /* Badges */
    .badge {
      display: inline-block; padding: 0.3rem 0.8rem; border-radius: 999px;
      font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;
      font-weight: 600; letter-spacing: 0.5px;
    }
    .badge-show { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); border: 1px solid rgba(168, 85, 247, 0.4); }
    .badge-do { background: rgba(52, 211, 153, 0.2); color: var(--accent-emerald); border: 1px solid rgba(52, 211, 153, 0.4); }
    .badge-livrable { background: rgba(129, 140, 248, 0.2); color: var(--accent-indigo); border: 1px solid rgba(129, 140, 248, 0.4); }

    /* Cards */
    .kanban-card {
      background: var(--bg-card); border: 1px solid var(--border-color);
      border-radius: 8px; padding: 1.2rem; transition: border-color 0.3s ease;
    }
    .kanban-card:hover { border-color: var(--accent-indigo); }
    .kanban-card h4 {
      font-family: 'Space Grotesk', sans-serif; font-size: 1rem;
      font-weight: 600; color: var(--accent-indigo); margin-bottom: 0.5rem;
    }
    .kanban-card p { font-size: 1rem !important; color: var(--text-secondary); }

    /* Checklists */
    .checklist li::before {
      content: '\2713'; background: transparent; color: var(--accent-emerald);
      font-size: 1rem; width: auto; height: auto; top: 0;
      box-shadow: none; border-radius: 0;
    }
    .crosslist li::before {
      content: '\2717'; background: transparent; color: var(--accent-rose);
      font-size: 1rem; width: auto; height: auto; top: 0;
      box-shadow: none; border-radius: 0;
    }

    /* Flow arrow */
    .flow-arrow { text-align: center; font-size: 2rem; color: var(--accent-purple); padding: 0.5rem; }

    /* Comparison cards */
    .vs-card {
      background: var(--bg-card); border: 1px solid var(--border-color);
      border-radius: 8px; padding: 1.5rem; text-align: center;
    }
    .vs-card.highlight { border-color: var(--accent-emerald); box-shadow: 0 0 20px rgba(52, 211, 153, 0.15); }
    .vs-card h4 {
      font-family: 'Space Grotesk', sans-serif; font-size: 1.1rem;
      font-weight: 600; margin-bottom: 0.75rem;
    }
    .vs-card.highlight h4 { color: var(--accent-emerald); }
    .vs-card p { font-size: 1rem !important; color: var(--text-secondary); }

    /* Animated pulse dot */
    @keyframes pulse-dot {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.5); opacity: 1; }
    }
    .pulse-dot {
      display: inline-block; width: 10px; height: 10px; border-radius: 50%;
      background: var(--accent-emerald); animation: pulse-dot 2s ease-in-out infinite;
    }

    /* Data flow animation */
    @keyframes data-flow {
      0% { stroke-dashoffset: 200; }
      100% { stroke-dashoffset: 0; }
    }

    /* Speaker notes */
    .speaker-notes {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: linear-gradient(180deg, transparent, var(--bg-dark) 20%);
      padding: 2rem 6rem; transform: translateY(100%);
      transition: transform 0.4s ease; z-index: 50;
    }
    .speaker-notes.visible { transform: translateY(0); }
    .speaker-notes-content {
      max-width: 1200px; margin: 0 auto; background: var(--bg-card);
      border: 1px solid var(--border-color); padding: 1.5rem; border-radius: 8px;
    }
    .speaker-notes-title {
      font-family: 'Space Grotesk', sans-serif; font-size: 0.75rem; font-weight: 700;
      color: var(--accent-amber); letter-spacing: 2px; margin-bottom: 0.75rem;
      display: flex; align-items: center; gap: 0.5rem;
    }
    .speaker-notes-text { font-size: 1rem; color: var(--text-secondary); line-height: 1.6; }

    /* TP panel */
    .tp-panel {
      position: fixed; top: 80px; right: 0; bottom: 0;
      width: min(520px, 92vw); background: var(--bg-dark);
      border-left: 1px solid var(--border-color);
      transform: translateX(100%); transition: transform 0.3s ease; z-index: 80;
    }
    .tp-panel.visible { transform: translateX(0); }
    .tp-panel-content { height: 100%; display: flex; flex-direction: column; padding: 1.5rem; }
    .tp-panel-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 1rem; font-family: 'Space Grotesk', sans-serif;
      font-size: 0.75rem; font-weight: 700; color: var(--accent-indigo); letter-spacing: 1px;
    }
    .tp-panel-actions { display: flex; gap: 0.75rem; font-size: 0.7rem; }
    .tp-panel-actions a { color: var(--text-secondary); text-decoration: none; border-bottom: 1px solid transparent; }
    .tp-panel-actions a:hover { color: var(--accent-indigo); border-color: var(--accent-indigo); }
    .tp-panel-body { overflow-y: auto; padding-right: 0.5rem; }
    .tp-panel-body h3 { font-family: 'Space Grotesk', sans-serif; font-size: 1rem; margin: 1rem 0 0.5rem; color: var(--accent-amber); letter-spacing: 0.5px; }
    .tp-panel-body h4 { font-family: 'Space Grotesk', sans-serif; font-size: 0.9rem; margin: 0.75rem 0 0.5rem; color: var(--accent-indigo); }
    .tp-panel-body p, .tp-panel-body li { font-size: 1rem; color: var(--text-secondary); }
    .tp-panel-body li { padding-left: 1.5rem; margin-bottom: 0.6rem; }
    .tp-panel-body li::before { width: 6px; height: 6px; top: 0.55em; }
    .tp-panel-body pre { font-size: 0.95rem; }
    .tp-panel-empty { font-size: 1rem; color: var(--text-dim); }

    /* Progress bar */
    .progress-container { position: fixed; bottom: 0; left: 0; right: 0; height: 3px; background: var(--border-color); z-index: 60; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent-indigo), var(--accent-cyan)); box-shadow: var(--glow-indigo); transition: width 0.3s ease; }

    /* Nav arrows */
    .nav-arrows { position: fixed; bottom: 2rem; right: 2rem; display: flex; gap: 0.5rem; z-index: 70; }
    .nav-arrow {
      width: 50px; height: 50px; background: var(--bg-card);
      border: 1px solid var(--border-color); color: var(--text-secondary);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: all 0.3s ease;
    }
    .nav-arrow:hover { border-color: var(--accent-indigo); color: var(--accent-indigo); background: rgba(129, 140, 248, 0.1); }
    .nav-arrow:disabled { opacity: 0.3; cursor: not-allowed; }
    .nav-arrow svg { width: 24px; height: 24px; }

    /* Counter */
    .slide-counter {
      position: fixed; bottom: 2rem; left: 2rem;
      font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
      color: var(--text-dim); z-index: 70;
    }
    .slide-counter .current { color: var(--accent-indigo); font-size: 1.2rem; }

    /* Animations */
    @keyframes fade-up {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .slide.active .slide-title { animation: fade-up 0.5s ease 0.2s both; }
    .slide.active .slide-subtitle { animation: fade-up 0.5s ease 0.3s both; }
    .slide.active ul, .slide.active ol, .slide.active p, .slide.active pre, .slide.active .info-box,
    .slide.active .two-col, .slide.active .three-col, .slide.active .four-col, .slide.active svg.diagram-svg {
      animation: fade-up 0.5s ease 0.4s both;
    }

    @keyframes glow-pulse {
      0%, 100% { box-shadow: 0 0 5px var(--accent-indigo); }
      50% { box-shadow: 0 0 20px var(--accent-indigo), 0 0 40px rgba(129, 140, 248, 0.3); }
    }

    /* Keyboard hint */
    .keyboard-hint {
      position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%);
      font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
      color: var(--text-dim); z-index: 70; display: flex; gap: 1rem; align-items: center;
    }
    .key { background: var(--bg-card); border: 1px solid var(--border-color); padding: 0.25rem 0.5rem; font-size: 0.7rem; }

    /* Slide menu */
    .slide-menu { position: relative; }
    .slide-menu-dropdown {
      position: absolute; top: 100%; left: 0; background: var(--bg-card);
      border: 1px solid var(--border-color); min-width: 280px; max-height: 400px;
      overflow-y: auto; display: none; z-index: 200;
    }
    .slide-menu-dropdown.visible { display: block; }
    .slide-menu-item {
      padding: 0.75rem 1rem; cursor: pointer; transition: background 0.2s ease;
      font-size: 0.9rem; border-bottom: 1px solid var(--border-color);
    }
    .slide-menu-item:hover { background: rgba(129, 140, 248, 0.1); }
    .slide-menu-item.active { background: rgba(129, 140, 248, 0.2); color: var(--accent-indigo); }
    .slide-menu-item .slide-menu-number {
      font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
      color: var(--accent-indigo); margin-right: 0.75rem;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .slide { padding: 2rem 3rem; }
      .two-col, .three-col { grid-template-columns: 1fr; gap: 2rem; }
      .four-col { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 768px) {
      .slide { padding: 1.5rem; }
      .nav-container { padding: 0.5rem 1rem; }
      .keyboard-hint { display: none; }
    }
  </style>
</head>
<body>
  <div class="grid-bg"></div>
  <div class="grid-accents"></div>

  <header>
    <div class="nav-container">
      <div class="logo">WS<span>/temps-reel</span></div>
      <nav class="day-nav">
        <button class="day-btn active" data-day="1">JOUR 1</button>
        <button class="day-btn" data-day="2">JOUR 2</button>
        <button class="day-btn" data-day="3">JOUR 3</button>
      </nav>
      <div class="nav-controls">
        <div class="slide-menu">
          <button class="control-btn" id="menuBtn" title="Menu des slides">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <div class="slide-menu-dropdown" id="slideMenu"></div>
        </div>
        <button class="control-btn label" id="tpBtn" title="Enonce TP (T)">TP</button>
        <button class="control-btn label" id="assistBtn" title="Mode assistance (A)">AIDE</button>
        <button class="control-btn" id="notesBtn" title="Notes orateur (N)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
          </svg>
        </button>
        <button class="control-btn" id="fullscreenBtn" title="Plein ecran (F)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 3 21 3 21 9"></polyline>
            <polyline points="9 21 3 21 3 15"></polyline>
            <line x1="21" y1="3" x2="14" y2="10"></line>
            <line x1="3" y1="21" x2="10" y2="14"></line>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main>
    <div class="slides-wrapper" id="slidesWrapper">

      <!-- ==================== JOUR 1 ==================== -->

      <!-- J1.01 - Hero -->
      <div class="slide" data-day="1" data-note="INTRO (5 min) — Se presenter. Promettre : 'Avant la fin de la journee, vous aurez un chat temps reel fonctionnel.' Demander le niveau : qui a deja utilise un WebSocket ? Socket.IO ? Rassurer : on part de zero sur le protocole. Socket.IO a domine le temps reel web pendant 10 ans, on va comprendre pourquoi et ce qui a change.">
        <div class="slide-content hero-slide">
          <span class="slide-number">J1.01</span>
          <h1 class="slide-title title-hero">WebSockets</h1>
          <p class="slide-subtitle" style="text-align:center; margin-top:-1rem;">Du HTTP au temps reel</p>
          <p class="author">Sion GENDERS</p>
          <p class="linkedin"><a href="https://www.linkedin.com/in/sion-gdrs/" target="_blank">linkedin.com/in/sion-gdrs</a></p>
        </div>
      </div>

      <!-- J1.02 - Plan -->
      <div class="slide" data-day="1" data-note="PLAN (2 min) — Parcourir rapidement. Insister : 80% pratique. A la fin du jour vous aurez un chat complet avec protocole type.">
        <div class="slide-content" style="text-align:center;">
          <span class="slide-number">J1.02</span>
          <h1 class="slide-title title-plan">Plan du jour</h1>
          <ol style="display:inline-block; text-align:left;">
            <li>Histoire du web temps reel</li>
            <li>Naissance du protocole WebSocket</li>
            <li>Socket.IO : de hero a optionnel</li>
            <li>Premier serveur echo <span class="badge badge-do">DO</span></li>
            <li>Chat broadcast <span class="badge badge-do">DO</span></li>
            <li>Protocole type + UI React <span class="badge badge-do">DO</span></li>
            <li>Mini-challenges <span class="badge badge-do">DO</span></li>
          </ol>
        </div>
      </div>

      <!-- J1.03 - Timeline web part 1 -->
      <div class="slide" data-day="1" data-note="HISTOIRE (5 min) — Raconter l'evolution : le web etait statique, puis dynamique cote serveur, puis AJAX a tout change (Gmail 2004). Insister : AJAX = asynchrone mais toujours request/response. Le serveur ne peut PAS pousser de donnees. Demander : 'Comment faire un chat avec du HTTP classique ?'">
        <div class="slide-content">
          <span class="slide-number">J1.03</span>
          <h1 class="slide-title">Le web : 30 ans d'evolution</h1>
          <div class="two-col" style="align-items:start;">
            <div>
              <div class="timeline-item">
                <span class="timeline-year">1991</span>
                <div class="timeline-content">HTML statique — pages en lecture seule</div>
              </div>
              <div class="timeline-item">
                <span class="timeline-year">1995</span>
                <div class="timeline-content">CGI / PHP — pages dynamiques cote serveur</div>
              </div>
              <div class="timeline-item">
                <span class="timeline-year">1999</span>
                <div class="timeline-content">XMLHttpRequest (IE5) — premier pas vers l'asynchrone</div>
              </div>
              <div class="timeline-item">
                <span class="timeline-year">2005</span>
                <div class="timeline-content"><strong>AJAX</strong> — Gmail, Google Maps : le web "moderne"</div>
              </div>
            </div>
            <div class="info-box">
              <div class="info-box-title">PROBLEME</div>
              <p>Meme avec AJAX, le serveur <strong>ne peut pas pousser</strong> de donnees vers le client. Il faut toujours une requete.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.04 - Les hacks du temps reel -->
      <div class="slide" data-day="1" data-note="HACKS (7 min) — Pour chaque technique, expliquer le principe et le probleme. Hidden iframe : le navigateur charge une page infinie. Comet/long-polling : on garde la requete ouverte. Flash XMLSocket : une vraie connexion TCP mais... il faut Flash. SSE : pousse unidirectionnel du serveur. Tous ces hacks marchent mais sont des bidouilles.">
        <div class="slide-content">
          <span class="slide-number">J1.04</span>
          <h1 class="slide-title">Les hacks du temps reel (2005-2010)</h1>
          <div class="four-col">
            <div class="kanban-card">
              <h4>Hidden iframe</h4>
              <p>Page infinie qui pousse du &lt;script&gt;</p>
              <p style="color:var(--accent-rose); margin-top:0.5rem;">Fuite memoire</p>
            </div>
            <div class="kanban-card">
              <h4>Long-polling</h4>
              <p>Requete gardee ouverte jusqu'a un evenement</p>
              <p style="color:var(--accent-rose); margin-top:0.5rem;">1 connexion / message</p>
            </div>
            <div class="kanban-card">
              <h4>Flash XMLSocket</h4>
              <p>Vraie connexion TCP via le plugin Flash</p>
              <p style="color:var(--accent-rose); margin-top:0.5rem;">Mort avec Flash</p>
            </div>
            <div class="kanban-card">
              <h4>SSE</h4>
              <p>EventSource : push serveur natif</p>
              <p style="color:var(--accent-amber); margin-top:0.5rem;">Unidirectionnel</p>
            </div>
          </div>
          <div class="info-box warning" style="margin-top:2rem;">
            <div class="info-box-title">CONSTAT</div>
            <p>Tous ces hacks tentent de simuler un canal bidirectionnel sur un protocole qui n'est pas fait pour ca.</p>
          </div>
        </div>
      </div>

      <!-- J1.05 - Polling vs WebSocket visual -->
      <div class="slide" data-day="1" data-note="COMPARAISON (5 min) — Montrer le diagramme. Polling : beaucoup de requetes, beaucoup de headers, beaucoup de latence. WebSocket : une seule connexion, des frames de 2 octets. Faire le calcul : 1 requete HTTP = ~800 octets de headers. 1 frame WS = 2-6 octets d'overhead. Pour 1000 messages/s, ca fait 800KB/s vs 6KB/s.">
        <div class="slide-content">
          <span class="slide-number">J1.05</span>
          <h1 class="slide-title">Polling vs WebSocket</h1>
          <div class="two-col">
            <div class="vs-card">
              <h4 style="color:var(--accent-rose);">HTTP Polling</h4>
              <svg viewBox="0 0 300 200" class="diagram-svg" style="width:100%;max-height:160px;">
                <text x="30" y="20" fill="#8b92b0" font-size="12" font-family="JetBrains Mono">Client</text>
                <text x="220" y="20" fill="#8b92b0" font-size="12" font-family="JetBrains Mono">Serveur</text>
                <line x1="50" y1="30" x2="50" y2="190" stroke="#1e2248" stroke-width="2"/>
                <line x1="250" y1="30" x2="250" y2="190" stroke="#1e2248" stroke-width="2"/>
                <line x1="50" y1="45" x2="250" y2="55" stroke="#fb7185" stroke-width="1.5" marker-end="url(#arrowR)"/>
                <line x1="250" y1="60" x2="50" y2="70" stroke="#4a5078" stroke-width="1.5" stroke-dasharray="4,3"/>
                <line x1="50" y1="85" x2="250" y2="95" stroke="#fb7185" stroke-width="1.5"/>
                <line x1="250" y1="100" x2="50" y2="110" stroke="#4a5078" stroke-width="1.5" stroke-dasharray="4,3"/>
                <line x1="50" y1="125" x2="250" y2="135" stroke="#fb7185" stroke-width="1.5"/>
                <line x1="250" y1="140" x2="50" y2="150" stroke="#34d399" stroke-width="1.5"/>
                <text x="100" y="175" fill="#fb7185" font-size="11" font-family="JetBrains Mono">~800 octets / requete</text>
              </svg>
              <p style="margin-top:0.5rem;">Requetes repetees, meme sans donnees</p>
            </div>
            <div class="vs-card highlight">
              <h4>WebSocket</h4>
              <svg viewBox="0 0 300 200" class="diagram-svg" style="width:100%;max-height:160px;">
                <text x="30" y="20" fill="#8b92b0" font-size="12" font-family="JetBrains Mono">Client</text>
                <text x="220" y="20" fill="#8b92b0" font-size="12" font-family="JetBrains Mono">Serveur</text>
                <line x1="50" y1="30" x2="50" y2="190" stroke="#1e2248" stroke-width="2"/>
                <line x1="250" y1="30" x2="250" y2="190" stroke="#1e2248" stroke-width="2"/>
                <line x1="50" y1="45" x2="250" y2="55" stroke="#818cf8" stroke-width="1.5"/>
                <text x="100" y="42" fill="#818cf8" font-size="9" font-family="JetBrains Mono">Upgrade</text>
                <line x1="250" y1="60" x2="50" y2="70" stroke="#818cf8" stroke-width="1.5"/>
                <text x="110" y="68" fill="#818cf8" font-size="9" font-family="JetBrains Mono">101 OK</text>
                <rect x="40" y="78" width="220" height="100" rx="4" fill="none" stroke="#34d399" stroke-width="1" stroke-dasharray="4,3"/>
                <text x="90" y="92" fill="#34d399" font-size="9" font-family="JetBrains Mono">connexion ouverte</text>
                <line x1="50" y1="105" x2="250" y2="110" stroke="#22d3ee" stroke-width="1.5"/>
                <line x1="250" y1="125" x2="50" y2="130" stroke="#22d3ee" stroke-width="1.5"/>
                <line x1="50" y1="145" x2="250" y2="150" stroke="#22d3ee" stroke-width="1.5"/>
                <line x1="250" y1="160" x2="50" y2="165" stroke="#22d3ee" stroke-width="1.5"/>
                <text x="100" y="190" fill="#34d399" font-size="11" font-family="JetBrains Mono">~2 octets / frame</text>
              </svg>
              <p style="margin-top:0.5rem;">1 connexion, messages bidirectionnels</p>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.06 - RFC 6455 -->
      <div class="slide" data-day="1" data-note="RFC (5 min) — 2008 premiere draft, 2011 standardise. Le genie : reutiliser le port 80/443 avec un Upgrade HTTP. Les proxies et firewalls laissent passer. Montrer le header Upgrade. Insister : c'est du HTTP normal au debut, puis ca bascule en WS.">
        <div class="slide-content">
          <span class="slide-number">J1.06</span>
          <h1 class="slide-title">WebSocket : RFC 6455 (2011)</h1>
          <div class="two-col">
            <div>
              <ul>
                <li><strong>2008</strong> : premiere draft</li>
                <li><strong>2011</strong> : RFC 6455 standardise</li>
                <li><strong>2012</strong> : tous les navigateurs modernes (IE10+)</li>
                <li>Reutilise les ports <strong>80</strong> (ws://) et <strong>443</strong> (wss://)</li>
                <li>Compatible avec l'infra existante (proxies, CDN)</li>
              </ul>
            </div>
            <div>
              <h3>Le handshake HTTP Upgrade</h3>
              <pre><code><span class="comment">// Requete client</span>
<span class="function">GET</span> /ws <span class="type">HTTP/1.1</span>
<span class="type">Upgrade</span>: websocket
<span class="type">Connection</span>: Upgrade
<span class="type">Sec-WebSocket-Key</span>: x3JJ...

<span class="comment">// Reponse serveur</span>
<span class="type">HTTP/1.1</span> <span class="number">101</span> Switching Protocols
<span class="type">Upgrade</span>: websocket
<span class="type">Connection</span>: Upgrade</code></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.07 - Handshake HTTP → WS -->
      <div class="slide" data-day="1" data-note="HANDSHAKE (3 min) — Le client envoie un GET HTTP classique avec les headers Upgrade. Le serveur repond 101 et la connexion bascule en WebSocket. A partir de la, c'est du full-duplex. Toujours wss:// en prod.">
        <div class="slide-content">
          <span class="slide-number">J1.07</span>
          <h1 class="slide-title">Le handshake HTTP → WS</h1>
          <svg viewBox="0 0 900 370" style="width:100%;max-width:900px;margin:0 auto;display:block;" xmlns="http://www.w3.org/2000/svg">
            <!-- Client box -->
            <rect x="40" y="10" width="180" height="50" rx="8" fill="#131631" stroke="#818cf8" stroke-width="2"/>
            <text x="130" y="42" text-anchor="middle" fill="#e8edf5" font-family="Space Grotesk, sans-serif" font-size="16" font-weight="600">Client (Browser)</text>
            <!-- Server box -->
            <rect x="680" y="10" width="180" height="50" rx="8" fill="#131631" stroke="#818cf8" stroke-width="2"/>
            <text x="770" y="42" text-anchor="middle" fill="#e8edf5" font-family="Space Grotesk, sans-serif" font-size="16" font-weight="600">Server</text>
            <!-- Lifelines -->
            <line x1="130" y1="60" x2="130" y2="360" stroke="#1e2248" stroke-width="2" stroke-dasharray="6,4"/>
            <line x1="770" y1="60" x2="770" y2="360" stroke="#1e2248" stroke-width="2" stroke-dasharray="6,4"/>
            <!-- Arrow 1: Client → Server -->
            <line x1="135" y1="100" x2="765" y2="100" stroke="#34d399" stroke-width="2" marker-end="url(#arrowGreen)"/>
            <text x="450" y="90" text-anchor="middle" fill="#34d399" font-family="JetBrains Mono, monospace" font-size="13" font-weight="600">GET / HTTP/1.1</text>
            <text x="450" y="120" text-anchor="middle" fill="#8b92b0" font-family="JetBrains Mono, monospace" font-size="11">Upgrade: websocket | Connection: Upgrade</text>
            <text x="450" y="138" text-anchor="middle" fill="#8b92b0" font-family="JetBrains Mono, monospace" font-size="11">Sec-WebSocket-Key: dGhl...</text>
            <!-- Arrow 2: Server → Client -->
            <line x1="765" y1="190" x2="135" y2="190" stroke="#818cf8" stroke-width="2" marker-end="url(#arrowIndigo)"/>
            <text x="450" y="180" text-anchor="middle" fill="#818cf8" font-family="JetBrains Mono, monospace" font-size="13" font-weight="600">HTTP/1.1 101 Switching Protocols</text>
            <text x="450" y="210" text-anchor="middle" fill="#8b92b0" font-family="JetBrains Mono, monospace" font-size="11">Upgrade: websocket | Sec-WebSocket-Accept: s3pP...</text>
            <!-- Arrow 3: Bidirectional -->
            <line x1="135" y1="280" x2="765" y2="280" stroke="#22d3ee" stroke-width="2" marker-end="url(#arrowCyan)"/>
            <line x1="765" y1="290" x2="135" y2="290" stroke="#22d3ee" stroke-width="2" marker-end="url(#arrowCyan2)"/>
            <text x="450" y="270" text-anchor="middle" fill="#22d3ee" font-family="JetBrains Mono, monospace" font-size="13" font-weight="600">ws:// ou wss:// (TLS)</text>
            <text x="450" y="320" text-anchor="middle" fill="#8b92b0" font-family="JetBrains Mono, monospace" font-size="12">Connexion persistante full-duplex</text>
            <!-- Arrow markers -->
            <defs>
              <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#34d399"/></marker>
              <marker id="arrowIndigo" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#818cf8"/></marker>
              <marker id="arrowCyan" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#22d3ee"/></marker>
              <marker id="arrowCyan2" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#22d3ee"/></marker>
            </defs>
          </svg>
          <div class="info-box" style="margin-top:1.5rem;">
            <div class="info-box-title">PRODUCTION</div>
            <p>Toujours utiliser <code>wss://</code> en production (chiffrement TLS). Le handshake passe par le port 443, compatible avec les proxies et CDN existants.</p>
          </div>
        </div>
      </div>

      <!-- J1.08 - Frames et full-duplex -->
      <div class="slide" data-day="1" data-note="FRAMES (3 min) — Apres le handshake, plus de HTTP. On echange des 'frames'. Text = UTF-8, Binary = octets bruts, Ping/Pong = heartbeat natif, Close = fermeture propre. Full-duplex = les deux cotes peuvent envoyer simultanement.">
        <div class="slide-content">
          <span class="slide-number">J1.08</span>
          <h1 class="slide-title">Frames & full-duplex</h1>
          <div class="two-col">
            <div>
              <h3>Types de frames (opcodes)</h3>
              <ul>
                <li><code>0x1</code> — Text (UTF-8)</li>
                <li><code>0x2</code> — Binary</li>
                <li><code>0x9</code> — Ping</li>
                <li><code>0xA</code> — Pong</li>
                <li><code>0x8</code> — Close</li>
              </ul>
            </div>
            <div>
              <div class="info-box success">
                <div class="info-box-title">FULL-DUPLEX</div>
                <p>Client et serveur peuvent envoyer des messages <strong>simultanement</strong>, sans attendre de reponse.</p>
                <p style="margin-top:0.5rem;">Overhead par frame : <strong>2 a 6 octets</strong> seulement.</p>
              </div>
              <div class="info-box" style="margin-top:1rem;">
                <div class="info-box-title">API BROWSER</div>
                <p>6 methodes : <code>new WebSocket(url)</code>, <code>onopen</code>, <code>onmessage</code>, <code>onclose</code>, <code>onerror</code>, <code>send()</code></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.09 - Socket.IO : de hero a optionnel -->
      <div class="slide" data-day="1" data-note="SOCKET.IO (10 min) — Socket.IO est sorti en 2010. Il a DOMINE le temps reel web pendant 10 ans (2010-2020). C'etait LE choix par defaut — quasi tout le monde l'utilisait. Depuis ~2020, la tendance s'inverse : WS natif suffit, les infra modernes supportent WS, et des alternatives serverless (Partykit, Supabase) emergent. Mais Socket.IO reste tres utilise (50k+ stars GitHub, 3M+ DL/semaine npm). On apprend le protocole brut pour comprendre ce que Socket.IO abstrait.">
        <div class="slide-content">
          <span class="slide-number">J1.09</span>
          <h1 class="slide-title">Socket.IO : de hero a optionnel</h1>
          <div class="two-col">
            <div>
              <h3 style="color:var(--accent-emerald);">Pourquoi il a domine (2010–2020)</h3>
              <ul class="checklist">
                <li>Fallbacks auto : Flash, JSONP, long-polling</li>
                <li>IE6/7/8/9 n'avaient pas WebSocket</li>
                <li>Reconnexion, rooms, namespaces — tout integre</li>
                <li>DX imbattable : <code>io.emit('event', data)</code></li>
                <li><strong>LE</strong> choix par defaut pendant 10 ans</li>
              </ul>
            </div>
            <div>
              <h3 style="color:var(--accent-amber);">Pourquoi la tendance change (~2020)</h3>
              <ul class="crosslist">
                <li>WS natif supporte partout (navigateurs, CDN, proxies)</li>
                <li>API browser simple — <code>new WebSocket(url)</code></li>
                <li>Reconnexion + rooms = peu de code a la main</li>
                <li>Alternatives serverless : Partykit, Supabase Realtime</li>
              </ul>
              <div class="info-box" style="margin-top:1rem;">
                <div class="info-box-title">SOCKET.IO AUJOURD'HUI</div>
                <p><strong>3M+ telechargements/semaine</strong> sur npm. Reste pertinent pour : namespaces, binary, fallback proxies corporate. Mais plus une <em>necessite</em>.</p>
              </div>
            </div>
          </div>
          <div class="info-box success" style="margin-top:1.5rem;">
            <div class="info-box-title">NOTRE APPROCHE</div>
            <p>On apprend le protocole brut d'abord — pour comprendre ce que Socket.IO <strong>abstrait</strong>.</p>
          </div>
        </div>
      </div>

      <!-- J1.10 - Notre stack -->
      <div class="slide" data-day="1" data-note="STACK (3 min) — Presenter la stack : serveur Node.js + ws (pas Socket.IO). Client React + TS + Vite. Types partages via discriminated unions. Justifier : ws = le plus proche du protocole brut, React = ce qu'ils connaissent, TS = type-safety sur les messages.">
        <div class="slide-content">
          <span class="slide-number">J1.10</span>
          <h1 class="slide-title">Notre stack</h1>
          <div class="three-col">
            <div class="kanban-card">
              <h4>Serveur</h4>
              <p>Node.js + TypeScript</p>
              <p><code>ws</code> (protocole brut)</p>
              <p style="color:var(--accent-emerald); margin-top:0.5rem;">Pas de Socket.IO</p>
            </div>
            <div class="kanban-card">
              <h4>Client</h4>
              <p>React + TypeScript</p>
              <p>Vite (build)</p>
              <p style="color:var(--accent-emerald); margin-top:0.5rem;">WebSocket natif</p>
            </div>
            <div class="kanban-card">
              <h4>Types partages</h4>
              <p>Discriminated unions</p>
              <p>Protocole type-safe</p>
              <p style="color:var(--accent-emerald); margin-top:0.5rem;">Client + serveur</p>
            </div>
          </div>
          <pre style="margin-top:2rem;"><code><span class="comment">// Discriminated union : le compilateur sait quel payload existe</span>
<span class="keyword">type</span> <span class="type">ServerMessage</span> =
  | { <span class="type">type</span>: <span class="string">'chat'</span>;   nick: <span class="type">string</span>; text: <span class="type">string</span> }
  | { <span class="type">type</span>: <span class="string">'system'</span>; text: <span class="type">string</span> }
  | { <span class="type">type</span>: <span class="string">'typing'</span>; nick: <span class="type">string</span> }</code></pre>
        </div>
      </div>

      <!-- J1.11 - Debugger les WebSocket -->
      <div class="slide" data-day="1" data-note="DEVTOOLS (3 min) — Montrer Chrome DevTools live. Onglet Network, filtre WS. Cliquer sur la connexion. Messages tab montre les frames. Tres utile pour debugger.">
        <div class="slide-content">
          <span class="slide-number">J1.11</span>
          <h1 class="slide-title">Debugger les WebSocket</h1>
          <div class="two-col">
            <div>
              <h3>Etapes dans Chrome DevTools</h3>
              <ol>
                <li>Ouvrir Chrome DevTools (<code>F12</code>)</li>
                <li>Onglet <strong>Network</strong> → filtre <strong>WS</strong></li>
                <li>Cliquer sur la connexion WebSocket</li>
                <li>Onglet <strong>Messages</strong> : voir les frames en direct</li>
                <li>Fleche verte ↑ = envoye, rouge ↓ = recu</li>
              </ol>
            </div>
            <div>
              <div class="info-box">
                <div class="info-box-title">TIPS</div>
                <ul>
                  <li>Verifier le status <code>101 Switching Protocols</code> dans Headers</li>
                  <li>Les frames Ping/Pong ne sont pas visibles dans DevTools</li>
                  <li>Utiliser <code>console.log</code> sur <code>ws.onmessage</code> pour debugger cote client</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.12 - TP Setup -->
      <div class="slide" data-day="1" data-note="SETUP (5 min) — Transition vers la pratique. Faire ensemble : mkdir, npm init, installer ws et typescript. Montrer la structure cible. Verifier que tout le monde a Node.js installe." data-exercise="../exercises/00-setup.md">
        <div class="slide-content">
          <span class="slide-number">J1.12</span>
          <h1 class="slide-title">Setup du projet</h1>
          <pre><code>mkdir ws-workshop && cd ws-workshop
npm init -y
npm i ws && npm i -D typescript ts-node @types/node @types/ws
npx tsc --init</code></pre>
          <div class="info-box">
            <div class="info-box-title">STRUCTURE CIBLE</div>
            <pre style="border:none; margin:0; padding:0;"><code>ws-workshop/
  server/
    src/index.ts
    tsconfig.json
  client/          <span class="comment">// React + Vite (plus tard)</span>
  shared/
    types.ts       <span class="comment">// Types partages</span></code></pre>
          </div>
        </div>
      </div>

      <!-- J1.13 - TP Echo server -->
      <div class="slide" data-day="1" data-note="ECHO (30 min) — Premier exercice. Expliquer WebSocketServer, l'evenement 'connection', puis 'message'. Montrer ws.send(). Tester avec un fichier HTML minimal. Checkpoint : un message envoye revient identique." data-exercise="../exercises/01-echo-server.md">
        <div class="slide-content">
          <span class="slide-number">J1.13</span>
          <h1 class="slide-title">TP : Echo server <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <pre><code><span class="keyword">import</span> { <span class="type">WebSocketServer</span> } <span class="keyword">from</span> <span class="string">'ws'</span>;

<span class="keyword">const</span> wss = <span class="keyword">new</span> <span class="type">WebSocketServer</span>({ port: <span class="number">8080</span> });

wss.<span class="function">on</span>(<span class="string">'connection'</span>, (ws) => {
  console.<span class="function">log</span>(<span class="string">'Client connecte'</span>);

  ws.<span class="function">on</span>(<span class="string">'message'</span>, (msg) => {
    ws.<span class="function">send</span>(msg.<span class="function">toString</span>());
  });
});</code></pre>
            </div>
            <div>
              <h3>Cote browser</h3>
              <pre><code><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="type">WebSocket</span>(
  <span class="string">'ws://localhost:8080'</span>
);
ws.<span class="function">onmessage</span> = (e) => {
  console.<span class="function">log</span>(e.data);
};
ws.<span class="function">send</span>(<span class="string">'Hello!'</span>);</code></pre>
              <div class="info-box success" style="margin-top:1rem;">
                <div class="info-box-title">CHECKPOINT</div>
                <p>Le message revient identique dans la console</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.14 - TP Chat broadcast -->
      <div class="slide" data-day="1" data-note="CHAT (45 min) — Transformer l'echo en broadcast. Montrer wss.clients (c'est un Set). Iterer et envoyer a tous. Ajouter les nicknames : le premier message = le pseudo. Annoncer les arrivees/departs. Tester avec 3 onglets." data-exercise="../exercises/02-chat-broadcast.md">
        <div class="slide-content">
          <span class="slide-number">J1.14</span>
          <h1 class="slide-title">TP : Chat broadcast <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Broadcast a tous</h3>
              <pre><code><span class="keyword">function</span> <span class="function">broadcast</span>(data: <span class="type">string</span>) {
  wss.clients.<span class="function">forEach</span>((c) => {
    <span class="keyword">if</span> (c.readyState === <span class="type">WebSocket</span>.OPEN) {
      c.<span class="function">send</span>(data);
    }
  });
}</code></pre>
            </div>
            <div>
              <h3>Mission</h3>
              <ul>
                <li>Premier message = nickname</li>
                <li>Messages suivants = broadcast</li>
                <li>Annoncer les arrivees/departs</li>
                <li>Tester avec <strong>3 onglets</strong></li>
              </ul>
              <div class="info-box success" style="margin-top:1rem;">
                <div class="info-box-title">CHECKPOINT</div>
                <p>3 onglets, chacun voit les messages des autres</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.15 - Pourquoi structurer -->
      <div class="slide" data-day="1" data-note="STRUCTURER (5 min) — Le chat envoie des strings bruts. Probleme : comment distinguer un message de chat d'une commande systeme ? d'un typing indicator ? Solution : enveloppe JSON { type, payload }. En TS : discriminated unions.">
        <div class="slide-content">
          <span class="slide-number">J1.15</span>
          <h1 class="slide-title">Pourquoi structurer les messages ?</h1>
          <div class="two-col">
            <div>
              <h3 style="color:var(--accent-rose);">Avant : strings bruts</h3>
              <pre><code><span class="string">"Alice: Salut !"</span>
<span class="string">"Alice a rejoint"</span>
<span class="string">"Alice est en train d'ecrire..."</span>
<span class="comment">// Comment distinguer ?</span></code></pre>
            </div>
            <div>
              <h3 style="color:var(--accent-emerald);">Apres : protocole type</h3>
              <pre><code>{ <span class="type">type</span>: <span class="string">"chat"</span>,   nick: <span class="string">"Alice"</span>,
  text: <span class="string">"Salut !"</span> }
{ <span class="type">type</span>: <span class="string">"system"</span>, text: <span class="string">"Alice a rejoint"</span> }
{ <span class="type">type</span>: <span class="string">"typing"</span>, nick: <span class="string">"Alice"</span> }
<span class="comment">// Switch sur type !</span></code></pre>
            </div>
          </div>
          <div class="info-box" style="margin-top:1.5rem;">
            <div class="info-box-title">PATTERN CLE</div>
            <p>Enveloppe <code>{ type, ...payload }</code> = le meme pattern que Redux, les events DOM, les messages MQTT.</p>
          </div>
        </div>
      </div>

      <!-- J1.16 - Discriminated unions -->
      <div class="slide" data-day="1" data-note="TYPES (5 min) — Montrer le type complet. Le switch sur type est exhaustif : TS previent si on oublie un cas. Montrer le fichier shared/types.ts qui sera utilise par client ET serveur. C'est le contrat entre les deux.">
        <div class="slide-content">
          <span class="slide-number">J1.16</span>
          <h1 class="slide-title">Discriminated unions en TypeScript</h1>
          <pre><code><span class="comment">// shared/types.ts — le contrat client ↔ serveur</span>

<span class="keyword">export type</span> <span class="type">ClientMessage</span> =
  | { <span class="type">type</span>: <span class="string">'set-nick'</span>;  nick: <span class="type">string</span> }
  | { <span class="type">type</span>: <span class="string">'chat'</span>;      text: <span class="type">string</span> }
  | { <span class="type">type</span>: <span class="string">'typing'</span> }

<span class="keyword">export type</span> <span class="type">ServerMessage</span> =
  | { <span class="type">type</span>: <span class="string">'chat'</span>;      nick: <span class="type">string</span>; text: <span class="type">string</span>; ts: <span class="type">number</span> }
  | { <span class="type">type</span>: <span class="string">'system'</span>;    text: <span class="type">string</span> }
  | { <span class="type">type</span>: <span class="string">'user-list'</span>; users: <span class="type">string</span>[] }
  | { <span class="type">type</span>: <span class="string">'typing'</span>;    nick: <span class="type">string</span> }</code></pre>
          <div class="info-box success" style="margin-top:1.5rem;">
            <div class="info-box-title">TYPE-SAFETY</div>
            <p>Le <code>switch (msg.type)</code> est <strong>exhaustif</strong> : TypeScript previent si vous oubliez un cas.</p>
          </div>
        </div>
      </div>

      <!-- J1.17 - TP Chat typed + React -->
      <div class="slide" data-day="1" data-note="CHAT TYPE (45 min) — Refactoriser le chat avec les types. Creer l'app React avec Vite. Composant App : input + liste + connexion indicator. Montrer le switch sur msg.type cote client et serveur." data-exercise="../exercises/03-chat-typed.md">
        <div class="slide-content">
          <span class="slide-number">J1.17</span>
          <h1 class="slide-title">TP : Chat type + React <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Serveur : switch sur type</h3>
              <pre><code>ws.<span class="function">on</span>(<span class="string">'message'</span>, (raw) => {
  <span class="keyword">const</span> msg: <span class="type">ClientMessage</span> =
    JSON.<span class="function">parse</span>(raw.<span class="function">toString</span>());

  <span class="keyword">switch</span> (msg.type) {
    <span class="keyword">case</span> <span class="string">'set-nick'</span>:
      <span class="comment">// ...</span>
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'chat'</span>:
      <span class="function">broadcast</span>({
        type: <span class="string">'chat'</span>,
        nick, text: msg.text,
        ts: Date.<span class="function">now</span>()
      });
      <span class="keyword">break</span>;
  }
});</code></pre>
            </div>
            <div>
              <h3>React : create + connect</h3>
              <pre><code>npm create vite@latest client \
  -- --template react-ts</code></pre>
              <ul style="margin-top:1rem;">
                <li>Input + bouton send</li>
                <li>Liste des messages</li>
                <li>Indicateur <span class="pulse-dot"></span> connexion</li>
                <li>Rendu different pour <code>chat</code> vs <code>system</code></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.18 - Mini-challenges -->
      <div class="slide" data-day="1" data-note="CHALLENGES (45 min) — 3 challenges independants. Le typing indicator est le plus fun : envoyer un event quand l'utilisateur tape, afficher 'Alice est en train d ecrire...' et le cacher apres 2s. La liste des users se met a jour a chaque connect/disconnect. Les timestamps sont envoyes par le serveur." data-exercise="../exercises/04-mini-challenges.md">
        <div class="slide-content">
          <span class="slide-number">J1.18</span>
          <h1 class="slide-title">Mini-challenges <span class="badge badge-do">DO</span></h1>
          <div class="three-col">
            <div class="kanban-card">
              <h4>1. Typing indicator</h4>
              <p>Envoyer <code>{type:'typing'}</code> quand l'utilisateur tape</p>
              <p>"Alice est en train d'ecrire..."</p>
              <p style="color:var(--accent-cyan); margin-top:0.5rem;">Disparait apres 2s</p>
            </div>
            <div class="kanban-card">
              <h4>2. User list live</h4>
              <p>Sidebar avec la liste des connectes</p>
              <p>Mise a jour a chaque connect/disconnect</p>
              <p style="color:var(--accent-cyan); margin-top:0.5rem;"><span class="pulse-dot"></span> Temps reel</p>
            </div>
            <div class="kanban-card">
              <h4>3. Timestamps + son</h4>
              <p>Horodatage "il y a 2s"</p>
              <p>Notification sonore quand onglet en arriere-plan</p>
              <p style="color:var(--accent-cyan); margin-top:0.5rem;">document.hidden</p>
            </div>
          </div>
        </div>
      </div>

      <!-- J1.19 - Recap -->
      <div class="slide" data-day="1" data-note="RECAP (5 min) — Tour de table : qui a un chat fonctionnel ? Rappeler les acquis. Teaser J2 : rooms, auth, resilience. Demain on passe en mode production.">
        <div class="slide-content">
          <span class="slide-number">J1.19</span>
          <h1 class="slide-title">Recap & teaser J2</h1>
          <div class="two-col">
            <div>
              <h3 style="color:var(--accent-emerald);">Acquis du jour</h3>
              <ul class="checklist">
                <li>Histoire du web temps reel</li>
                <li>Protocole WebSocket (RFC 6455)</li>
                <li>Serveur Node.js + <code>ws</code></li>
                <li>API browser <code>WebSocket</code></li>
                <li>Messages types (discriminated unions)</li>
                <li>Chat fonctionnel avec React</li>
              </ul>
            </div>
            <div>
              <h3>Demain : production patterns</h3>
              <ul>
                <li><strong>Rooms</strong> — chat multi-salons</li>
                <li><strong>Auth</strong> — JWT sur le handshake</li>
                <li><strong>Heartbeat</strong> — detection zombie</li>
                <li><strong>Reconnexion</strong> — backoff exponentiel</li>
                <li><strong>State sync</strong> — late joiners</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== JOUR 2 ==================== -->

      <!-- J2.01 - Hero -->
      <div class="slide" data-day="2" data-note="INTRO J2 (3 min) — Recap rapide de J1. Aujourd'hui on passe en mode production : rooms, auth, resilience. A la fin du jour, le chat sera pret pour la prod.">
        <div class="slide-content hero-slide">
          <span class="slide-number">J2.01</span>
          <h1 class="slide-title title-hero">Jour 2</h1>
          <p class="slide-subtitle" style="text-align:center; margin-top:-1rem;">Patterns de production</p>
          <p class="author">Rooms, Auth, Resilience</p>
        </div>
      </div>

      <!-- J2.02 - Rappel -->
      <div class="slide" data-day="2" data-note="RAPPEL (5 min) — Schema : client se connecte, envoie du JSON type, serveur broadcast. Demander : quels problemes voyez-vous pour la prod ? (pas de rooms, pas d'auth, pas de reconnexion, pas de state sync)">
        <div class="slide-content">
          <span class="slide-number">J2.02</span>
          <h1 class="slide-title">Rappel J1</h1>
          <div class="two-col">
            <div>
              <h3 style="color:var(--accent-emerald);">Ce qu'on a</h3>
              <ul class="checklist">
                <li>Serveur WS Node/TS</li>
                <li>Protocole type <code>{ type, ... }</code></li>
                <li>Chat broadcast + UI React</li>
              </ul>
            </div>
            <div>
              <h3 style="color:var(--accent-rose);">Ce qui manque</h3>
              <ul class="crosslist">
                <li>Rooms — tout le monde dans le meme canal</li>
                <li>Auth — n'importe qui peut se connecter</li>
                <li>Resilience — si le serveur tombe, c'est fini</li>
                <li>State sync — un nouveau venu ne voit rien</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.03 - Rooms concept -->
      <div class="slide" data-day="2" data-note="ROOMS (10 min) — Concept : au lieu de broadcaster a tout le monde, on route vers un sous-ensemble. Implementer avec Map<string, Set<WebSocket>>. Join = ajouter au Set. Leave = retirer. Broadcast cible = iterer sur le Set de la room.">
        <div class="slide-content">
          <span class="slide-number">J2.03</span>
          <h1 class="slide-title">Rooms & channels</h1>
          <div class="two-col">
            <div>
              <svg viewBox="0 0 300 200" class="diagram-svg" style="width:100%;max-height:180px;">
                <text x="120" y="20" fill="#818cf8" font-size="12" font-family="Space Grotesk" font-weight="600">Serveur</text>
                <rect x="100" y="30" width="100" height="40" rx="6" fill="none" stroke="#818cf8" stroke-width="1.5"/>
                <text x="115" y="55" fill="#8b92b0" font-size="11" font-family="JetBrains Mono">rooms Map</text>
                <rect x="20" y="100" width="80" height="35" rx="6" fill="none" stroke="#22d3ee" stroke-width="1"/>
                <text x="30" y="122" fill="#22d3ee" font-size="10" font-family="JetBrains Mono">#general</text>
                <rect x="120" y="100" width="80" height="35" rx="6" fill="none" stroke="#34d399" stroke-width="1"/>
                <text x="133" y="122" fill="#34d399" font-size="10" font-family="JetBrains Mono">#random</text>
                <rect x="220" y="100" width="70" height="35" rx="6" fill="none" stroke="#fbbf24" stroke-width="1"/>
                <text x="232" y="122" fill="#fbbf24" font-size="10" font-family="JetBrains Mono">#tech</text>
                <line x1="130" y1="70" x2="60" y2="100" stroke="#1e2248" stroke-width="1"/>
                <line x1="150" y1="70" x2="160" y2="100" stroke="#1e2248" stroke-width="1"/>
                <line x1="170" y1="70" x2="255" y2="100" stroke="#1e2248" stroke-width="1"/>
                <circle cx="30" cy="160" r="6" fill="#22d3ee" opacity="0.6"/>
                <circle cx="55" cy="165" r="6" fill="#22d3ee" opacity="0.6"/>
                <circle cx="80" cy="160" r="6" fill="#22d3ee" opacity="0.6"/>
                <circle cx="135" cy="160" r="6" fill="#34d399" opacity="0.6"/>
                <circle cx="165" cy="165" r="6" fill="#34d399" opacity="0.6"/>
                <circle cx="240" cy="160" r="6" fill="#fbbf24" opacity="0.6"/>
                <circle cx="265" cy="165" r="6" fill="#fbbf24" opacity="0.6"/>
              </svg>
            </div>
            <div>
              <h3>Implementation</h3>
              <pre><code><span class="keyword">const</span> rooms = <span class="keyword">new</span> <span class="type">Map</span>&lt;<span class="type">string</span>, <span class="type">Set</span>&lt;<span class="type">WebSocket</span>&gt;&gt;();

<span class="keyword">function</span> <span class="function">joinRoom</span>(ws, room) {
  <span class="keyword">if</span> (!rooms.<span class="function">has</span>(room))
    rooms.<span class="function">set</span>(room, <span class="keyword">new</span> <span class="type">Set</span>());
  rooms.<span class="function">get</span>(room).<span class="function">add</span>(ws);
}

<span class="keyword">function</span> <span class="function">broadcastToRoom</span>(room, msg) {
  rooms.<span class="function">get</span>(room)?.<span class="function">forEach</span>(c =&gt; {
    c.<span class="function">send</span>(JSON.<span class="function">stringify</span>(msg));
  });
}</code></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.04 - TP Rooms -->
      <div class="slide" data-day="2" data-note="TP ROOMS (45 min) — Ajouter les messages join-room et leave-room. Modifier le broadcast pour cibler la room. UI : sidebar avec les rooms, bouton pour creer une room. Un client ne peut etre que dans une seule room a la fois." data-exercise="../exercises/05-rooms.md">
        <div class="slide-content">
          <span class="slide-number">J2.04</span>
          <h1 class="slide-title">TP : Chat multi-rooms <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Nouveaux messages</h3>
              <pre><code><span class="comment">// Client → Serveur</span>
{ <span class="type">type</span>: <span class="string">'join-room'</span>, room: <span class="string">'general'</span> }
{ <span class="type">type</span>: <span class="string">'leave-room'</span> }

<span class="comment">// Serveur → Client</span>
{ <span class="type">type</span>: <span class="string">'room-joined'</span>,
  room: <span class="string">'general'</span>,
  users: [<span class="string">'Alice'</span>, <span class="string">'Bob'</span>] }</code></pre>
            </div>
            <div>
              <h3>Mission</h3>
              <ul>
                <li>Creer / rejoindre des rooms</li>
                <li>Broadcast cible par room</li>
                <li>Sidebar React avec liste de rooms</li>
                <li>Indicateur de room active</li>
              </ul>
              <div class="info-box success" style="margin-top:1rem;">
                <div class="info-box-title">CHECKPOINT</div>
                <p>Un message dans #general n'apparait pas dans #random</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.05 - Auth concept -->
      <div class="slide" data-day="2" data-note="AUTH (10 min) — Probleme : le nickname est self-declared. N'importe qui peut se faire passer pour quelqu'un d'autre. Solution : JWT. Le client appelle /login, recoit un token, se connecte en WS avec ?token=xxx. Le serveur verifie et attache le userId au socket.">
        <div class="slide-content">
          <span class="slide-number">J2.05</span>
          <h1 class="slide-title">Authentification WebSocket</h1>
          <div class="two-col">
            <div>
              <h3>Le probleme</h3>
              <p>Le handshake WebSocket ne supporte pas les headers custom depuis le browser.</p>
              <h3 style="margin-top:1.5rem;">3 strategies</h3>
              <ol>
                <li><code>ws://host?token=xxx</code> (query param)</li>
                <li>Premier message = token</li>
                <li><code>Sec-WebSocket-Protocol</code> header</li>
              </ol>
            </div>
            <div>
              <h3>Flow recommande</h3>
              <pre><code><span class="comment">// 1. Login HTTP</span>
POST /login { user, pass }
  → { token: <span class="string">"eyJhbG..."</span> }

<span class="comment">// 2. Connect WS avec token</span>
<span class="keyword">new</span> <span class="type">WebSocket</span>(
  <span class="string">`ws://host?token=${token}`</span>
)

<span class="comment">// 3. Serveur verifie</span>
jwt.<span class="function">verify</span>(token, SECRET)
  → { userId: <span class="string">"alice"</span> }</code></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.06 - TP Auth -->
      <div class="slide" data-day="2" data-note="TP AUTH (45 min) — Installer jsonwebtoken. Creer un endpoint /login avec 2-3 comptes hardcodes. Le client stocke le token et se connecte. Le serveur extrait le token du query param et verifie. Si invalide : fermer avec code 4001." data-exercise="../exercises/06-auth.md">
        <div class="slide-content">
          <span class="slide-number">J2.06</span>
          <h1 class="slide-title">TP : Auth JWT <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Serveur : verifier le token</h3>
              <pre><code>wss.<span class="function">on</span>(<span class="string">'connection'</span>, (ws, req) => {
  <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="type">URL</span>(
    req.url, <span class="string">'http://localhost'</span>);
  <span class="keyword">const</span> token =
    url.searchParams.<span class="function">get</span>(<span class="string">'token'</span>);

  <span class="keyword">try</span> {
    <span class="keyword">const</span> user =
      jwt.<span class="function">verify</span>(token, SECRET);
    <span class="comment">// Attacher au socket</span>
    (ws <span class="keyword">as any</span>).userId = user.sub;
  } <span class="keyword">catch</span> {
    ws.<span class="function">close</span>(<span class="number">4001</span>, <span class="string">'Unauthorized'</span>);
  }
});</code></pre>
            </div>
            <div>
              <h3>Mission</h3>
              <ul>
                <li>Endpoint <code>POST /login</code></li>
                <li>2-3 comptes hardcodes</li>
                <li>Token dans le query param WS</li>
                <li>Username verifie (plus self-declared)</li>
              </ul>
              <div class="info-box warning" style="margin-top:1rem;">
                <div class="info-box-title">SECURITE</div>
                <p>Le token dans l'URL est visible dans les logs. En prod : utiliser <code>wss://</code> + premier message.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.07 - Securite WebSocket -->
      <div class="slide" data-day="2" data-note="SECURITE (3 min) — Checklist rapide. Le point cle : les WebSocket n'ont PAS de CORS comme les requetes HTTP. Il faut valider manuellement.">
        <div class="slide-content">
          <span class="slide-number">J2.07</span>
          <h1 class="slide-title">Securite WebSocket — Checklist</h1>
          <ul class="checklist">
            <li>Toujours <code>wss://</code> en production (TLS obligatoire)</li>
            <li>Valider le header <code>Origin</code> cote serveur</li>
            <li>Authentifier <strong>avant</strong> d'accepter les messages</li>
            <li>Rate-limiter les messages par connexion</li>
            <li>Valider et sanitiser tout le JSON entrant</li>
            <li>Configurer <code>maxPayload</code> dans les options <code>ws</code></li>
            <li>Utiliser les codes de fermeture appropries (1000, 4001...)</li>
          </ul>
          <div class="info-box danger" style="margin-top:1.5rem;">
            <div class="info-box-title">ATTENTION</div>
            <p>Les WebSocket contournent les protections CORS du navigateur. Sans validation d'Origin et auth, n'importe qui peut se connecter a votre serveur.</p>
          </div>
        </div>
      </div>

      <!-- J2.08 - Heartbeat -->
      <div class="slide" data-day="2" data-note="HEARTBEAT (5 min) — Probleme : un client peut se deconnecter sans envoyer de Close (perte reseau, laptop ferme). Le serveur garde un socket zombie. Solution : ping/pong. Le serveur envoie un ping toutes les 30s. Si pas de pong : terminer.">
        <div class="slide-content">
          <span class="slide-number">J2.08</span>
          <h1 class="slide-title">Heartbeat & reconnexion</h1>
          <div class="two-col">
            <div>
              <h3>Serveur : ping/pong</h3>
              <pre><code><span class="keyword">const</span> HEARTBEAT = <span class="number">30_000</span>;

<span class="function">setInterval</span>(() => {
  wss.clients.<span class="function">forEach</span>((ws) => {
    <span class="keyword">if</span> (!ws.isAlive) {
      ws.<span class="function">terminate</span>();
      <span class="keyword">return</span>;
    }
    ws.isAlive = <span class="keyword">false</span>;
    ws.<span class="function">ping</span>();
  });
}, HEARTBEAT);

wss.<span class="function">on</span>(<span class="string">'connection'</span>, (ws) => {
  ws.isAlive = <span class="keyword">true</span>;
  ws.<span class="function">on</span>(<span class="string">'pong'</span>, () => {
    ws.isAlive = <span class="keyword">true</span>;
  });
});</code></pre>
            </div>
            <div>
              <h3>Client : backoff exponentiel</h3>
              <pre><code><span class="keyword">function</span> <span class="function">connect</span>(attempt = <span class="number">0</span>) {
  <span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="type">WebSocket</span>(url);

  ws.<span class="function">onopen</span> = () => {
    attempt = <span class="number">0</span>; <span class="comment">// reset</span>
  };

  ws.<span class="function">onclose</span> = () => {
    <span class="keyword">const</span> delay = Math.<span class="function">min</span>(
      <span class="number">1000</span> * <span class="number">2</span> ** attempt,
      <span class="number">30_000</span>
    );
    <span class="function">setTimeout</span>(
      () => <span class="function">connect</span>(attempt + <span class="number">1</span>),
      delay
    );
  };
}</code></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.09 - TP Resilience -->
      <div class="slide" data-day="2" data-note="TP RESILIENCE (45 min) — Implementer le ping/pong serveur. Creer un hook useWebSocket avec reconnect + backoff + etat. Afficher l'etat dans l'UI. Tester : couper le serveur, relancer, verifier la reprise." data-exercise="../exercises/07-heartbeat-reconnect.md">
        <div class="slide-content">
          <span class="slide-number">J2.09</span>
          <h1 class="slide-title">TP : Chat resilient <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Hook useWebSocket</h3>
              <pre><code><span class="keyword">function</span> <span class="function">useWebSocket</span>(url) {
  <span class="keyword">const</span> [status, setStatus] =
    <span class="function">useState</span>(<span class="string">'connecting'</span>);
  <span class="keyword">const</span> [messages, setMessages] =
    <span class="function">useState</span>([]);

  <span class="comment">// Auto-reconnect avec backoff</span>
  <span class="comment">// Gestion ping/pong</span>
  <span class="comment">// Reset backoff on success</span>

  <span class="keyword">return</span> { status, messages,
    send };
}</code></pre>
            </div>
            <div>
              <h3>Etats UI</h3>
              <div class="three-col" style="gap:1rem; margin-top:1rem;">
                <div style="text-align:center;">
                  <div style="width:12px;height:12px;border-radius:50%;background:#34d399;margin:0 auto 0.5rem;"></div>
                  <p style="font-size:1rem !important;">Connected</p>
                </div>
                <div style="text-align:center;">
                  <div style="width:12px;height:12px;border-radius:50%;background:#fbbf24;margin:0 auto 0.5rem;animation:pulse-dot 1s infinite;"></div>
                  <p style="font-size:1rem !important;">Reconnecting</p>
                </div>
                <div style="text-align:center;">
                  <div style="width:12px;height:12px;border-radius:50%;background:#fb7185;margin:0 auto 0.5rem;"></div>
                  <p style="font-size:1rem !important;">Disconnected</p>
                </div>
              </div>
              <div class="info-box success" style="margin-top:1.5rem;">
                <div class="info-box-title">TEST</div>
                <p>Ctrl+C le serveur → l'UI passe en orange → relancer → reprise auto</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.10 - State sync -->
      <div class="slide" data-day="2" data-note="STATE SYNC (5 min) — Probleme : un client qui rejoint apres le debut ne voit rien. Solution : le serveur garde un buffer des N derniers messages par room. A la connexion, envoyer { type: 'sync', messages: [...], users: [...] }. Le client remplace son etat par le snapshot.">
        <div class="slide-content">
          <span class="slide-number">J2.10</span>
          <h1 class="slide-title">State sync & late joiners</h1>
          <div class="two-col">
            <div>
              <h3 style="color:var(--accent-rose);">Le probleme</h3>
              <p>Alice et Bob discutent depuis 30 min.</p>
              <p>Charlie rejoint : ecran <strong>vide</strong>.</p>
              <h3 style="margin-top:1.5rem; color:var(--accent-emerald);">La solution</h3>
              <p>Le serveur garde les <strong>N derniers messages</strong> par room.</p>
              <p>A la connexion → <code>{ type: 'sync' }</code></p>
            </div>
            <div>
              <pre><code><span class="comment">// Buffer circulaire serveur</span>
<span class="keyword">const</span> history = <span class="keyword">new</span> <span class="type">Map</span>&lt;<span class="type">string</span>, <span class="type">Message</span>[]&gt;();
<span class="keyword">const</span> MAX = <span class="number">50</span>;

<span class="keyword">function</span> <span class="function">addToHistory</span>(room, msg) {
  <span class="keyword">const</span> buf = history.<span class="function">get</span>(room) ?? [];
  buf.<span class="function">push</span>(msg);
  <span class="keyword">if</span> (buf.length > MAX) buf.<span class="function">shift</span>();
  history.<span class="function">set</span>(room, buf);
}

<span class="comment">// A la connexion</span>
ws.<span class="function">send</span>(JSON.<span class="function">stringify</span>({
  type: <span class="string">'sync'</span>,
  messages: history.<span class="function">get</span>(room),
  users: <span class="function">getUsersInRoom</span>(room)
}));</code></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.11 - TP State sync -->
      <div class="slide" data-day="2" data-note="TP STATE SYNC (45 min) — Implementer le buffer circulaire. Envoyer sync a la connexion. Cote client : remplacer l'etat par le snapshot. Ajouter un separateur 'Messages precedents'." data-exercise="../exercises/08-state-sync.md">
        <div class="slide-content">
          <span class="slide-number">J2.11</span>
          <h1 class="slide-title">TP : State sync <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Mission</h3>
              <ul>
                <li>Buffer des 50 derniers messages/room</li>
                <li>Envoyer <code>sync</code> au join</li>
                <li>Afficher l'historique avec separateur</li>
                <li>Liste des users presents</li>
              </ul>
              <div class="info-box success" style="margin-top:1rem;">
                <div class="info-box-title">CHECKPOINT</div>
                <p>Un nouvel onglet voit les 50 derniers messages immediatement</p>
              </div>
            </div>
            <div>
              <h3>Client : gerer le sync</h3>
              <pre><code><span class="keyword">case</span> <span class="string">'sync'</span>:
  <span class="function">setMessages</span>([
    ...(msg.messages.<span class="function">map</span>(m => ({
      ...m, isHistory: <span class="keyword">true</span>
    }))),
    { type: <span class="string">'separator'</span> }
  ]);
  <span class="function">setUsers</span>(msg.users);
  <span class="keyword">break</span>;</code></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- J2.12 - Recap + briefing J3 -->
      <div class="slide" data-day="2" data-note="RECAP (10 min) — Tour de table. Tous les patterns sont en place. Briefing J3 : demain on construit un Kahoot-like en equipe. Montrer l'architecture cible et le protocole.">
        <div class="slide-content">
          <span class="slide-number">J2.12</span>
          <h1 class="slide-title">Recap & briefing projet J3</h1>
          <div class="two-col">
            <div>
              <h3 style="color:var(--accent-emerald);">Patterns maitrises</h3>
              <ul class="checklist">
                <li>Rooms & channels</li>
                <li>Auth JWT sur WebSocket</li>
                <li>Heartbeat ping/pong</li>
                <li>Reconnexion backoff exponentiel</li>
                <li>State sync pour late joiners</li>
                <li>Hook <code>useWebSocket</code></li>
              </ul>
            </div>
            <div>
              <h3>Demain : Live Quiz</h3>
              <p>Un Kahoot-like en temps reel :</p>
              <ul>
                <li><strong>Host</strong> cree un quiz, lance les questions</li>
                <li><strong>Joueurs</strong> rejoignent via un code</li>
                <li>Resultats et leaderboard <strong>en live</strong></li>
                <li>Demo finale : les autres equipes jouent !</li>
              </ul>
              <div class="info-box" style="margin-top:1rem;">
                <div class="info-box-title">EQUIPES</div>
                <p>Former les equipes de 2-3 personnes ce soir</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== JOUR 3 ==================== -->

      <!-- J3.01 - Hero -->
      <div class="slide" data-day="3" data-note="INTRO J3 (2 min) — Aujourd'hui c'est projet. Tout ce qu'on a appris en J1 et J2 se combine. Demo live en fin de journee.">
        <div class="slide-content hero-slide">
          <span class="slide-number">J3.01</span>
          <h1 class="slide-title title-hero">Jour 3</h1>
          <p class="slide-subtitle" style="text-align:center; margin-top:-1rem;">Projet : Live Quiz & Vote</p>
          <p class="author">Build, Ship, Demo</p>
        </div>
      </div>

      <!-- J3.02 - Briefing -->
      <div class="slide" data-day="3" data-note="BRIEFING (10 min) — Presenter le projet en detail. Montrer un screenshot de Kahoot pour l'inspiration. Expliquer les 3 roles : host, joueur, spectateur. Les patterns utilises : rooms (1 par quiz), auth (host vs joueur), state machine, state sync, reconnexion.">
        <div class="slide-content">
          <span class="slide-number">J3.02</span>
          <h1 class="slide-title">Le projet : Live Quiz</h1>
          <div class="three-col">
            <div class="kanban-card">
              <h4 style="color:var(--accent-amber);">Host</h4>
              <ul style="font-size:1rem;">
                <li style="font-size:1rem;">Cree un quiz</li>
                <li style="font-size:1rem;">Lance les questions</li>
                <li style="font-size:1rem;">Voit les resultats live</li>
                <li style="font-size:1rem;">Affiche le leaderboard</li>
              </ul>
            </div>
            <div class="kanban-card">
              <h4 style="color:var(--accent-cyan);">Joueurs</h4>
              <ul style="font-size:1rem;">
                <li style="font-size:1rem;">Rejoignent via un code</li>
                <li style="font-size:1rem;">Repondent aux questions</li>
                <li style="font-size:1rem;">Score base sur la rapidite</li>
                <li style="font-size:1rem;">Voient leur classement</li>
              </ul>
            </div>
            <div class="kanban-card">
              <h4 style="color:var(--accent-emerald);">Patterns utilises</h4>
              <ul class="checklist" style="font-size:1rem;">
                <li style="font-size:1rem;">Rooms (1 par quiz)</li>
                <li style="font-size:1rem;">Auth (host vs joueur)</li>
                <li style="font-size:1rem;">State machine</li>
                <li style="font-size:1rem;">State sync + reconnexion</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- J3.03 - Architecture -->
      <div class="slide" data-day="3" data-note="ARCHI (5 min) — Montrer le schema : monorepo avec server, host-app, player-app, shared-types. Le serveur gere les rooms quiz. Les types sont partages entre les 3 packages.">
        <div class="slide-content">
          <span class="slide-number">J3.03</span>
          <h1 class="slide-title">Architecture cible</h1>
          <div class="two-col">
            <div>
              <pre><code>quiz-app/
├── packages/
│   └── shared-types/   <span class="comment"># Types TS</span>
├── server/             <span class="comment"># Node + ws</span>
├── host-app/           <span class="comment"># React (Vite)</span>
└── player-app/         <span class="comment"># React (Vite)</span></code></pre>
              <svg viewBox="0 0 300 140" class="diagram-svg" style="width:100%;max-height:140px;margin-top:1rem;">
                <rect x="100" y="10" width="100" height="35" rx="6" fill="none" stroke="#818cf8" stroke-width="1.5"/>
                <text x="115" y="32" fill="#818cf8" font-size="11" font-family="JetBrains Mono">Serveur WS</text>
                <line x1="120" y1="45" x2="50" y2="80" stroke="#1e2248" stroke-width="1"/>
                <line x1="150" y1="45" x2="150" y2="80" stroke="#1e2248" stroke-width="1"/>
                <line x1="180" y1="45" x2="250" y2="80" stroke="#1e2248" stroke-width="1"/>
                <rect x="10" y="80" width="80" height="30" rx="6" fill="none" stroke="#fbbf24" stroke-width="1"/>
                <text x="25" y="100" fill="#fbbf24" font-size="10" font-family="JetBrains Mono">Host</text>
                <rect x="110" y="80" width="80" height="30" rx="6" fill="none" stroke="#22d3ee" stroke-width="1"/>
                <text x="120" y="100" fill="#22d3ee" font-size="10" font-family="JetBrains Mono">Player 1</text>
                <rect x="210" y="80" width="80" height="30" rx="6" fill="none" stroke="#22d3ee" stroke-width="1"/>
                <text x="220" y="100" fill="#22d3ee" font-size="10" font-family="JetBrains Mono">Player 2</text>
                <rect x="60" y="120" width="180" height="20" rx="4" fill="none" stroke="#34d399" stroke-width="1" stroke-dasharray="3,3"/>
                <text x="95" y="134" fill="#34d399" font-size="9" font-family="JetBrains Mono">shared-types</text>
              </svg>
            </div>
            <div>
              <h3>Protocole (types partages)</h3>
              <pre><code><span class="keyword">type</span> <span class="type">QuizPhase</span> =
  | <span class="string">'lobby'</span>
  | <span class="string">'question'</span>
  | <span class="string">'results'</span>
  | <span class="string">'leaderboard'</span>
  | <span class="string">'ended'</span>

<span class="keyword">type</span> <span class="type">ClientMessage</span> =
  | { type: <span class="string">'join'</span>;
      quizCode: <span class="type">string</span>;
      name: <span class="type">string</span> }
  | { type: <span class="string">'answer'</span>;
      questionId: <span class="type">number</span>;
      choiceIndex: <span class="type">number</span> }
  | { type: <span class="string">'host:start'</span> }
  | { type: <span class="string">'host:next'</span> }</code></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- J3.04 - State machine -->
      <div class="slide" data-day="3" data-note="STATE MACHINE (5 min) — Le quiz a un lifecycle clair : lobby (attente joueurs) → question (timer) → results (distribution) → boucle ou leaderboard → ended. Chaque transition est declenchee par un message du host. Le timer est gere cote serveur.">
        <div class="slide-content">
          <span class="slide-number">J3.04</span>
          <h1 class="slide-title">State machine du quiz</h1>
          <svg viewBox="0 0 700 120" class="diagram-svg" style="width:100%;max-height:120px;">
            <rect x="10" y="35" width="90" height="40" rx="8" fill="none" stroke="#818cf8" stroke-width="2"/>
            <text x="30" y="60" fill="#818cf8" font-size="12" font-family="Space Grotesk" font-weight="600">LOBBY</text>
            <line x1="100" y1="55" x2="150" y2="55" stroke="#4a5078" stroke-width="1.5" marker-end="url(#arr)"/>
            <text x="105" y="48" fill="#4a5078" font-size="8" font-family="JetBrains Mono">start</text>
            <rect x="150" y="35" width="110" height="40" rx="8" fill="none" stroke="#22d3ee" stroke-width="2"/>
            <text x="162" y="60" fill="#22d3ee" font-size="12" font-family="Space Grotesk" font-weight="600">QUESTION</text>
            <line x1="260" y1="55" x2="310" y2="55" stroke="#4a5078" stroke-width="1.5"/>
            <text x="265" y="48" fill="#4a5078" font-size="8" font-family="JetBrains Mono">timer/all</text>
            <rect x="310" y="35" width="100" height="40" rx="8" fill="none" stroke="#fbbf24" stroke-width="2"/>
            <text x="322" y="60" fill="#fbbf24" font-size="12" font-family="Space Grotesk" font-weight="600">RESULTS</text>
            <line x1="410" y1="55" x2="460" y2="55" stroke="#4a5078" stroke-width="1.5"/>
            <text x="420" y="48" fill="#4a5078" font-size="8" font-family="JetBrains Mono">next</text>
            <rect x="460" y="35" width="130" height="40" rx="8" fill="none" stroke="#34d399" stroke-width="2"/>
            <text x="468" y="60" fill="#34d399" font-size="11" font-family="Space Grotesk" font-weight="600">LEADERBOARD</text>
            <line x1="590" y1="55" x2="630" y2="55" stroke="#4a5078" stroke-width="1.5"/>
            <rect x="630" y="35" width="60" height="40" rx="8" fill="none" stroke="#fb7185" stroke-width="2"/>
            <text x="640" y="60" fill="#fb7185" font-size="12" font-family="Space Grotesk" font-weight="600">END</text>
            <path d="M 360 75 Q 360 100 255 100 Q 150 100 205 75" fill="none" stroke="#4a5078" stroke-width="1" stroke-dasharray="4,3"/>
            <text x="230" y="110" fill="#4a5078" font-size="8" font-family="JetBrains Mono">next (pas derniere)</text>
          </svg>
          <div class="two-col" style="margin-top:1.5rem;">
            <div class="info-box">
              <div class="info-box-title">TIMER SERVEUR</div>
              <p><code>setTimeout</code> par question. Envoyer des <code>tick</code> chaque seconde. Forcer le passage aux results a l'expiration.</p>
            </div>
            <div class="info-box success">
              <div class="info-box-title">SCORING</div>
              <p>Reponse correcte = <code>1000 * (tempsRestant / tempsTot)</code>. Plus tu reponds vite, plus tu gagnes.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- J3.05 - TP Starter code -->
      <div class="slide" data-day="3" data-note="TP SETUP (10 min) — Cloner le starter, installer les deps, explorer la structure, verifier que tout demarre." data-exercise="../exercises/09-projet-setup.md">
        <div class="slide-content">
          <span class="slide-number">J3.05</span>
          <h1 class="slide-title">TP : Starter code <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Etapes</h3>
              <ol>
                <li>Cloner le starter code</li>
                <li><code>npm install</code> dans chaque package</li>
                <li>Explorer la structure</li>
                <li>Verifier que tout demarre</li>
              </ol>
            </div>
            <div>
              <div class="info-box">
                <div class="info-box-title">FOURNI vs A IMPLEMENTER</div>
                <p>Le starter inclut la structure monorepo, les types partages, le setup Vite + React et les squelettes de composants. Vous implementez la logique serveur (QuizRoom), les handlers de messages et l'UI interactive.</p>
              </div>
              <div class="info-box success" style="margin-top:1rem;">
                <div class="info-box-title">REPARTITION EQUIPE</div>
                <ul style="margin:0;">
                  <li style="font-size:1.2rem;">1 personne : serveur + state machine</li>
                  <li style="font-size:1.2rem;">1 personne : front host</li>
                  <li style="font-size:1.2rem;">1 personne : front joueur</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J3.06 - TP Serveur quiz -->
      <div class="slide" data-day="3" data-note="TP SERVEUR (60 min) — Le squelette QuizRoom est fourni, les etudiants implementent le corps des methodes. Gerer tous les messages. Timer par question. Calcul des scores." data-exercise="../exercises/10-serveur-quiz.md">
        <div class="slide-content">
          <span class="slide-number">J3.06</span>
          <h1 class="slide-title">TP : Serveur quiz <span class="badge badge-do">DO</span></h1>
          <pre><code><span class="keyword">class</span> <span class="type">QuizRoom</span> {
  code: <span class="type">string</span>;           <span class="comment">// "ABC123"</span>
  phase: <span class="type">QuizPhase</span>;       <span class="comment">// state machine</span>
  players: <span class="type">Map</span>&lt;<span class="type">WebSocket</span>, { name: <span class="type">string</span>; score: <span class="type">number</span> }&gt;;
  questions: <span class="type">QuizQuestion</span>[];
  currentQ: <span class="type">number</span>;
  answers: <span class="type">Map</span>&lt;<span class="type">string</span>, <span class="type">number</span>&gt;; <span class="comment">// playerId → choiceIndex</span>
  timer: <span class="type">NodeJS.Timeout</span> | <span class="keyword">null</span>;

  <span class="function">start</span>()    { <span class="comment">/* lobby → question */</span> }
  <span class="function">nextQ</span>()    { <span class="comment">/* results → question | leaderboard */</span> }
  <span class="function">answer</span>(ws, choice) { <span class="comment">/* score = 1000 * remaining/total */</span> }
  <span class="function">tick</span>()     { <span class="comment">/* broadcast countdown */</span> }
  <span class="function">timeUp</span>()   { <span class="comment">/* question → results */</span> }
}</code></pre>
        </div>
      </div>

      <!-- J3.07 - TP Front Host -->
      <div class="slide" data-day="3" data-note="TP HOST (50 min) — Les squelettes de composants et le CSS sont fournis. Interface host : creation du quiz, lobby avec code, affichage des resultats en live avec barres animees." data-exercise="../exercises/11-front-host.md">
        <div class="slide-content">
          <span class="slide-number">J3.07</span>
          <h1 class="slide-title">TP : Front Host <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Ecrans</h3>
              <ol>
                <li><strong>Creation</strong> — titre + questions</li>
                <li><strong>Lobby</strong> — code quiz + joueurs</li>
                <li><strong>Question</strong> — timer + nb reponses</li>
                <li><strong>Resultats</strong> — barres animees</li>
                <li><strong>Leaderboard</strong> — classement</li>
              </ol>
            </div>
            <div>
              <h3>Barres animees (CSS)</h3>
              <pre><code><span class="comment">/* Transition sur width */</span>
.<span class="type">result-bar</span> {
  height: <span class="number">40</span>px;
  <span class="keyword">transition</span>: width <span class="number">0.8</span>s ease;
  width: <span class="number">0</span>;
}

<span class="comment">/* Set via style inline */</span>
style={{ width: <span class="string">`${pct}%`</span> }}</code></pre>
              <div class="info-box" style="margin-top:1rem;">
                <div class="info-box-title">ASTUCE</div>
                <p>Le code quiz doit etre <strong>grand et visible</strong> pour que les joueurs puissent le lire</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J3.08 - TP Front Joueur -->
      <div class="slide" data-day="3" data-note="TP JOUEUR (50 min) — Les squelettes de composants et le CSS sont fournis. Interface joueur : ecran de join, boutons colores Kahoot-style, feedback correct/incorrect." data-exercise="../exercises/12-front-joueur.md">
        <div class="slide-content">
          <span class="slide-number">J3.08</span>
          <h1 class="slide-title">TP : Front Joueur <span class="badge badge-do">DO</span></h1>
          <div class="two-col">
            <div>
              <h3>Ecrans</h3>
              <ol>
                <li><strong>Join</strong> — code + pseudo</li>
                <li><strong>Lobby</strong> — "En attente..."</li>
                <li><strong>Question</strong> — 4 boutons couleur</li>
                <li><strong>Feedback</strong> — correct / incorrect</li>
                <li><strong>Score</strong> — classement perso</li>
              </ol>
            </div>
            <div>
              <h3>Boutons Kahoot-style</h3>
              <div class="four-col" style="gap:0.5rem; margin-top:1rem;">
                <div style="background:#e21b3c; padding:1.5rem 0.5rem; text-align:center; border-radius:8px; font-weight:600;">A</div>
                <div style="background:#1368ce; padding:1.5rem 0.5rem; text-align:center; border-radius:8px; font-weight:600;">B</div>
                <div style="background:#d89e00; padding:1.5rem 0.5rem; text-align:center; border-radius:8px; font-weight:600;">C</div>
                <div style="background:#26890c; padding:1.5rem 0.5rem; text-align:center; border-radius:8px; font-weight:600;">D</div>
              </div>
              <div class="info-box warning" style="margin-top:1rem;">
                <div class="info-box-title">UX</div>
                <p>Desactiver les boutons apres la reponse. Feedback immediat.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J3.09 - Scaling -->
      <div class="slide" data-day="3" data-note="SCALING (15 min) — Scaling horizontal : sticky sessions (le client doit toujours atterrir sur le meme process). Redis adapter pour multi-process. Alternatives modernes : Partykit, Liveblocks, Supabase Realtime. Socket.IO reste utile quand : namespaces complexes, binary, corporate proxies.">
        <div class="slide-content">
          <span class="slide-number">J3.09</span>
          <h1 class="slide-title">Scaling & alternatives</h1>
          <div class="two-col">
            <div>
              <h3>Scaling horizontal</h3>
              <ul>
                <li><strong>Sticky sessions</strong> — meme client = meme process</li>
                <li><strong>Redis pub/sub</strong> — partager l'etat entre process</li>
                <li><strong>WS gateway</strong> — load balancer aware WS</li>
              </ul>
              <h3 style="margin-top:1.5rem;">Quand choisir quoi ?</h3>
              <ul>
                <li><strong>SSE</strong> — push serveur unidirectionnel</li>
                <li><strong>WebSocket</strong> — bidirectionnel, temps reel</li>
                <li><strong>Polling</strong> — donnees qui changent rarement</li>
              </ul>
            </div>
            <div>
              <h3>Alternatives modernes</h3>
              <div class="kanban-card" style="margin-bottom:0.75rem;">
                <h4 style="color:var(--accent-purple);">Partykit / Cloudflare Durable Objects</h4>
                <p>Serverless WebSocket — chaque room = un worker</p>
              </div>
              <div class="kanban-card" style="margin-bottom:0.75rem;">
                <h4 style="color:var(--accent-cyan);">Supabase Realtime</h4>
                <p>Postgres changes en temps reel via WS</p>
              </div>
              <div class="kanban-card">
                <h4 style="color:var(--accent-amber);">Socket.IO (encore utile quand...)</h4>
                <p>Namespaces complexes, binary, proxies corporate</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- J3.10 - TP Polish -->
      <div class="slide" data-day="3" data-note="TP POLISH (10 min) — Edge cases requis (double answer, code invalide), reconnexion et late join en bonus, tests croises entre equipes." data-exercise="../exercises/13-robustesse.md">
        <div class="slide-content">
          <span class="slide-number">J3.10</span>
          <h1 class="slide-title">TP : Robustesse <span class="badge badge-do">DO</span></h1>
          <div class="three-col">
            <div class="kanban-card">
              <h4>Reconnexion (Bonus)</h4>
              <p>Un joueur qui revient mid-quiz doit retrouver son etat</p>
            </div>
            <div class="kanban-card">
              <h4>Edge cases</h4>
              <p><strong>Requis :</strong> double answer, code invalide. <strong>Bonus :</strong> host disconnect, late join spectateur</p>
            </div>
            <div class="kanban-card">
              <h4>Tests croises</h4>
              <p>Echanger les URLs entre equipes et tester</p>
            </div>
          </div>
          <div class="info-box" style="margin-top:2rem;">
            <div class="info-box-title">SCRIPT DE DEMO (3 min)</div>
            <ol>
              <li style="font-size:1.2rem;">Ouvrir le dashboard host</li>
              <li style="font-size:1.2rem;">Creer un quiz (3 questions fun)</li>
              <li style="font-size:1.2rem;">Afficher le code — les autres equipes rejoignent</li>
              <li style="font-size:1.2rem;">Lancer les questions — resultats live</li>
              <li style="font-size:1.2rem;">Leaderboard final</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- J3.11 - Demo -->
      <div class="slide" data-day="3" data-note="DEMO (20 min) — Chaque equipe fait sa demo. Les autres equipes jouent ! Vote de la meilleure app. Debrief final.">
        <div class="slide-content hero-slide">
          <span class="slide-number">J3.11</span>
          <h1 class="slide-title title-hero">Demo time !</h1>
          <p class="slide-subtitle" style="text-align:center;">Chaque equipe presente — les autres jouent</p>
          <div class="three-col" style="margin-top:2rem;">
            <div class="kanban-card" style="text-align:center;">
              <h4>3 min</h4>
              <p>par equipe</p>
            </div>
            <div class="kanban-card" style="text-align:center;">
              <h4>Live</h4>
              <p>les autres jouent</p>
            </div>
            <div class="kanban-card" style="text-align:center;">
              <h4>Vote</h4>
              <p>meilleure app</p>
            </div>
          </div>
        </div>
      </div>

      <!-- J3.12 - Recap final -->
      <div class="slide" data-day="3" data-note="RECAP FINAL (10 min) — Tour de table. Recap des 3 jours. Ressources pour aller plus loin. Felicitations !">
        <div class="slide-content">
          <span class="slide-number">J3.12</span>
          <h1 class="slide-title">Recap des 3 jours</h1>
          <div class="three-col">
            <div class="kanban-card">
              <h4 style="color:var(--accent-indigo);">Jour 1 : Fondations</h4>
              <ul class="checklist" style="font-size:1rem;">
                <li style="font-size:1rem;">Histoire du web temps reel</li>
                <li style="font-size:1rem;">Protocole WebSocket</li>
                <li style="font-size:1rem;">Serveur echo + chat</li>
                <li style="font-size:1rem;">Messages types TS</li>
              </ul>
            </div>
            <div class="kanban-card">
              <h4 style="color:var(--accent-cyan);">Jour 2 : Production</h4>
              <ul class="checklist" style="font-size:1rem;">
                <li style="font-size:1rem;">Rooms & channels</li>
                <li style="font-size:1rem;">Auth JWT</li>
                <li style="font-size:1rem;">Heartbeat & reconnexion</li>
                <li style="font-size:1rem;">State sync</li>
              </ul>
            </div>
            <div class="kanban-card">
              <h4 style="color:var(--accent-emerald);">Jour 3 : Projet</h4>
              <ul class="checklist" style="font-size:1rem;">
                <li style="font-size:1rem;">Architecture monorepo</li>
                <li style="font-size:1rem;">State machine</li>
                <li style="font-size:1rem;">UI temps reel React</li>
                <li style="font-size:1rem;">Demo live !</li>
              </ul>
            </div>
          </div>
          <div class="info-box success" style="margin-top:2rem;">
            <div class="info-box-title">POUR ALLER PLUS LOIN</div>
            <p>WebTransport (UDP-based) &middot; Partykit &middot; Socket.IO pour les cas complexes &middot; CRDT pour le collaboratif</p>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Speaker notes -->
  <div class="speaker-notes" id="speakerNotes">
    <div class="speaker-notes-content">
      <div class="speaker-notes-title">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
        </svg>
        NOTES ORATEUR
      </div>
      <p class="speaker-notes-text" id="notesText">Aucune note pour cette slide.</p>
    </div>
  </div>

  <!-- TP panel -->
  <div class="tp-panel" id="tpPanel">
    <div class="tp-panel-content">
      <div class="tp-panel-header">
        <span>TP — ENONCE</span>
        <div class="tp-panel-actions">
          <a href="#" id="tpOpenLink" target="_blank" rel="noopener noreferrer">ouvrir</a>
        </div>
      </div>
      <div class="tp-panel-body" id="tpPanelBody">
        <p class="tp-panel-empty">Aucun enonce pour cette slide.</p>
      </div>
    </div>
  </div>

  <!-- Progress bar -->
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <!-- Nav arrows -->
  <div class="nav-arrows">
    <button class="nav-arrow" id="prevBtn" title="Slide precedente">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
    </button>
    <button class="nav-arrow" id="nextBtn" title="Slide suivante">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
    </button>
  </div>

  <div class="slide-counter">
    <span class="current" id="currentSlide">1</span> / <span id="totalSlides">1</span>
  </div>

  <div class="keyboard-hint">
    <span class="key">&larr;</span><span class="key">&rarr;</span> naviguer
    <span class="key">N</span> notes
    <span class="key">F</span> plein ecran
    <span class="key">T</span> TP
    <span class="key">A</span> aide
  </div>

  <script>
    let currentDay = 1;
    let currentSlideIndex = 0;
    let notesVisible = false;
    let tpVisible = false;
    let assistMode = false;
    let currentExercisePath = '';
    const exerciseCache = new Map();
    let slides = [];
    let filteredSlides = [];

    const slidesWrapper = document.getElementById('slidesWrapper');
    const dayBtns = document.querySelectorAll('.day-btn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const notesBtn = document.getElementById('notesBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const menuBtn = document.getElementById('menuBtn');
    const slideMenu = document.getElementById('slideMenu');
    const speakerNotes = document.getElementById('speakerNotes');
    const notesText = document.getElementById('notesText');
    const progressBar = document.getElementById('progressBar');
    const currentSlideEl = document.getElementById('currentSlide');
    const totalSlidesEl = document.getElementById('totalSlides');
    const tpBtn = document.getElementById('tpBtn');
    const assistBtn = document.getElementById('assistBtn');
    const tpPanel = document.getElementById('tpPanel');
    const tpPanelBody = document.getElementById('tpPanelBody');
    const tpOpenLink = document.getElementById('tpOpenLink');

    function init() {
      slides = Array.from(document.querySelectorAll('.slide'));
      filterSlidesByDay(currentDay);
      updateSlide();
      buildSlideMenu();
    }

    function filterSlidesByDay(day) {
      currentDay = day;
      filteredSlides = slides.filter(s => parseInt(s.dataset.day) === day);
      currentSlideIndex = 0;
      dayBtns.forEach(btn => btn.classList.toggle('active', parseInt(btn.dataset.day) === day));
      slides.forEach(s => s.classList.remove('active', 'prev'));
      buildSlideMenu();
      updateSlide();
    }

    function buildSlideMenu() {
      slideMenu.innerHTML = '';
      filteredSlides.forEach((slide, index) => {
        const number = slide.querySelector('.slide-number')?.textContent || '';
        const title = slide.querySelector('.slide-title')?.textContent?.substring(0, 40) || '';
        const item = document.createElement('div');
        item.className = 'slide-menu-item' + (index === currentSlideIndex ? ' active' : '');
        item.innerHTML = `<span class="slide-menu-number">${number}</span>${title}`;
        item.addEventListener('click', () => { goToSlide(index); slideMenu.classList.remove('visible'); });
        slideMenu.appendChild(item);
      });
    }

    function updateSlide() {
      filteredSlides.forEach((slide, index) => {
        slide.classList.remove('active', 'prev');
        if (index === currentSlideIndex) slide.classList.add('active');
        else if (index < currentSlideIndex) slide.classList.add('prev');
      });
      const currentSlide = filteredSlides[currentSlideIndex];
      notesText.textContent = currentSlide?.dataset.note || 'Aucune note pour cette slide.';
      progressBar.style.width = `${((currentSlideIndex + 1) / filteredSlides.length) * 100}%`;
      currentSlideEl.textContent = currentSlideIndex + 1;
      totalSlidesEl.textContent = filteredSlides.length;
      prevBtn.disabled = currentSlideIndex === 0;
      nextBtn.disabled = currentSlideIndex === filteredSlides.length - 1;
      document.querySelectorAll('.slide-menu-item').forEach((item, i) => item.classList.toggle('active', i === currentSlideIndex));
      updateTpPanelAvailability();
    }

    function nextSlide() { if (currentSlideIndex < filteredSlides.length - 1) { currentSlideIndex++; updateSlide(); } }
    function prevSlide() { if (currentSlideIndex > 0) { currentSlideIndex--; updateSlide(); } }
    function goToSlide(index) { if (index >= 0 && index < filteredSlides.length) { currentSlideIndex = index; updateSlide(); } }

    function toggleNotes() {
      notesVisible = !notesVisible;
      speakerNotes.classList.toggle('visible', notesVisible);
      notesBtn.classList.toggle('active', notesVisible);
    }

    function setTpVisible(visible) {
      tpVisible = visible;
      tpPanel.classList.toggle('visible', tpVisible);
      tpBtn.classList.toggle('active', tpVisible);
      if (tpVisible && notesVisible) { notesVisible = false; speakerNotes.classList.remove('visible'); notesBtn.classList.remove('active'); }
    }

    function toggleTp() {
      const currentSlide = filteredSlides[currentSlideIndex];
      if (!currentSlide?.dataset.exercise) return;
      setTpVisible(!tpVisible);
      if (tpVisible) loadExerciseForSlide(currentSlide);
    }

    function toggleAssist() {
      const currentSlide = filteredSlides[currentSlideIndex];
      if (!currentSlide?.dataset.exercise) return;
      assistMode = !assistMode;
      assistBtn.classList.toggle('active', assistMode);
      if (tpVisible) loadExerciseForSlide(currentSlide);
    }

    function stripAssistSection(markdown) {
      const lines = markdown.split('\n'); const output = []; let skip = false;
      for (const line of lines) {
        if (/^##\s*(Aide|Assistance)\b/i.test(line)) { skip = true; continue; }
        if (skip && /^#{1,6}\s+/.test(line)) skip = false;
        if (!skip) output.push(line);
      }
      return output.join('\n');
    }

    function escapeHtml(t) { return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

    function renderMarkdown(markdown) {
      const lines = markdown.split('\n'); let html = ''; let inCode = false; let listType = null;
      const closeList = () => { if (listType) { html += `</${listType}>`; listType = null; } };
      for (const line of lines) {
        if (line.trim().startsWith('```')) { if (inCode) { html += '</code></pre>'; inCode = false; } else { closeList(); html += '<pre><code>'; inCode = true; } continue; }
        if (inCode) { html += `${escapeHtml(line)}\n`; continue; }
        if (line.trim() === '') { closeList(); continue; }
        const hm = line.match(/^(#{1,3})\s+(.*)$/);
        if (hm) { closeList(); html += `<${hm[1].length <= 2 ? 'h3' : 'h4'}>${escapeHtml(hm[2])}</${hm[1].length <= 2 ? 'h3' : 'h4'}>`; continue; }
        const om = line.match(/^\d+\.\s+(.*)$/);
        if (om) { if (listType !== 'ol') { closeList(); listType = 'ol'; html += '<ol>'; } html += `<li>${escapeHtml(om[1])}</li>`; continue; }
        const bm = line.match(/^-\s+(.*)$/);
        if (bm) { if (listType !== 'ul') { closeList(); listType = 'ul'; html += '<ul>'; } html += `<li>${escapeHtml(bm[1])}</li>`; continue; }
        closeList(); html += `<p>${escapeHtml(line)}</p>`;
      }
      closeList(); if (inCode) html += '</code></pre>';
      return html;
    }

    function renderExercise(markdown) { tpPanelBody.innerHTML = renderMarkdown(assistMode ? markdown : stripAssistSection(markdown)); }

    function loadExerciseForSlide(slide) {
      const exercisePath = slide?.dataset.exercise || '';
      if (!exercisePath) { tpPanelBody.innerHTML = '<p class="tp-panel-empty">Aucun enonce pour cette slide.</p>'; tpOpenLink.href = '#'; return; }
      currentExercisePath = exercisePath;
      const exerciseUrl = new URL(exercisePath, window.location.href).toString();
      tpOpenLink.href = exerciseUrl;
      const cached = exerciseCache.get(exercisePath);
      if (cached) { renderExercise(cached); return; }
      tpPanelBody.innerHTML = '<p class="tp-panel-empty">Chargement...</p>';
      fetch(exerciseUrl).then(r => { if (!r.ok) throw new Error('not found'); return r.text(); })
        .then(text => { exerciseCache.set(exercisePath, text); renderExercise(text); })
        .catch(() => { tpPanelBody.innerHTML = '<p class="tp-panel-empty">Enonce introuvable.</p>'; });
    }

    function updateTpPanelAvailability() {
      const s = filteredSlides[currentSlideIndex]; const ep = s?.dataset.exercise; const has = !!ep;
      tpBtn.disabled = !has; assistBtn.disabled = !has;
      assistBtn.classList.toggle('active', assistMode && has);
      if (!has) { setTpVisible(false); return; }
      if (tpVisible && ep !== currentExercisePath) loadExerciseForSlide(s);
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) { document.documentElement.requestFullscreen(); fullscreenBtn.classList.add('active'); }
      else { document.exitFullscreen(); fullscreenBtn.classList.remove('active'); }
    }

    dayBtns.forEach(btn => btn.addEventListener('click', () => filterSlidesByDay(parseInt(btn.dataset.day))));
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);
    notesBtn.addEventListener('click', toggleNotes);
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    tpBtn.addEventListener('click', toggleTp);
    assistBtn.addEventListener('click', toggleAssist);

    menuBtn.addEventListener('click', (e) => { e.stopPropagation(); slideMenu.classList.toggle('visible'); });
    document.addEventListener('click', (e) => { if (!slideMenu.contains(e.target) && e.target !== menuBtn) slideMenu.classList.remove('visible'); });

    document.addEventListener('keydown', (e) => {
      switch(e.key) {
        case 'ArrowRight': case 'ArrowDown': case ' ': e.preventDefault(); nextSlide(); break;
        case 'ArrowLeft': case 'ArrowUp': e.preventDefault(); prevSlide(); break;
        case 'n': case 'N': toggleNotes(); break;
        case 'f': case 'F': toggleFullscreen(); break;
        case 't': case 'T': toggleTp(); break;
        case 'a': case 'A': toggleAssist(); break;
        case 'Escape': slideMenu.classList.remove('visible'); break;
        case '1': filterSlidesByDay(1); break;
        case '2': filterSlidesByDay(2); break;
        case '3': filterSlidesByDay(3); break;
      }
    });

    let touchStartX = 0;
    slidesWrapper.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; }, { passive: true });
    slidesWrapper.addEventListener('touchend', (e) => {
      const diff = touchStartX - e.changedTouches[0].screenX;
      if (Math.abs(diff) > 50) { if (diff > 0) nextSlide(); else prevSlide(); }
    }, { passive: true });

    document.addEventListener('fullscreenchange', () => fullscreenBtn.classList.toggle('active', !!document.fullscreenElement));

    init();
  </script>
</body>
</html>
